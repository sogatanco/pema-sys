"use strict";(self.webpackChunkmaterialpro_main=self.webpackChunkmaterialpro_main||[]).push([[2940],{60375:(e,a,n)=>{n.r(a),n.d(a,{default:()=>Y});var t=n(65043),s=n(73216),i=n(49157),l=n(22016),r=n(15710),c=n(86506),d=n(24056),o=n(93933),m=n(203),u=n(59781),h=n(93397),x=n(77348),j=n(89379),p=n(18353),g=n(12327),v=n(22345),b=n(22019),y=n(70579);const N={chart:{toolbar:{show:!1},fontFamily:"'Poppins', sans-serif"},dataLabels:{enabled:!1},colors:["rgba(255,255,255,0.5)"],xaxis:{categories:["0","4","8","12","16","20","24","30"],labels:{show:!1},axisBorder:{show:!1},axisTicks:{show:!1}},stroke:{curve:"smooth",width:3,colors:"rgba(255, 255, 255, 0.5)"},yaxis:{show:!1},grid:{show:!1},tooltip:{enabled:!1,theme:"dark"}},A=[{name:"Bandwidth usage",data:[5,0,12,1,8,3,12,15]}],f={chart:{fontFamily:"'Rubik', sans-serif"},dataLabels:{enabled:!1},xaxis:{categories:["Permohonan Biaya","Tagihan Biaya","Aktual Biaya","Reimbursement"],labels:{show:!1}},plotOptions:{bar:{distributed:!0,horizontal:!1}},grid:{borderColor:"rgba(0,0,0,0.1)"},yaxis:{labels:{style:{cssClass:"grey--text lighten-2--text fill-color"}}},title:{text:"Grafik Pengajuan Tahun ".concat((new Date).getFullYear()),align:"left",style:{fontSize:"16px",color:"#6c757d"}},tooltip:{theme:"dark"}},w=e=>{let{diproses:a,selesai:n,totalPengajuan:t,dataChart:s}=e;const l=["Permohonan Biaya","Tagihan Biaya","Aktual Biaya","Reimbursement"],r=[{name:"Pengajuan",data:null===l||void 0===l?void 0:l.map((e=>{const a=null===s||void 0===s?void 0:s.find((a=>a.kategori===e));return a?a.total:0}))}];return(0,y.jsx)("div",{children:(0,y.jsx)(i.A,{children:(0,y.jsxs)(p.A,{children:[(0,y.jsxs)(g.A,{children:[(0,y.jsx)(v.A,{md:4,className:"mt-3",children:(0,y.jsx)(i.A,{className:"bg-warning",children:(0,y.jsxs)(p.A,{children:[(0,y.jsxs)("div",{className:"d-flex",children:[(0,y.jsx)("div",{className:"me-3 align-self-center",children:(0,y.jsx)("h1",{className:"text-dark-white",children:(0,y.jsx)("i",{className:"bi bi-pie-chart"})})}),(0,y.jsxs)("div",{children:[(0,y.jsx)("h4",{className:"text-dark-white",children:"Pengajuan Diproses"}),(0,y.jsxs)("h6",{className:"text-dark-white",children:["Tahun ",(new Date).getFullYear()]})]})]}),(0,y.jsxs)(g.A,{children:[(0,y.jsx)(v.A,{xs:5,className:"d-flex align-items-center",children:(0,y.jsx)("h1",{className:"text-dark-white text-truncate mb-0",children:a})}),(0,y.jsx)(v.A,{xs:7,className:"align-self-center",children:(0,y.jsx)("div",{className:"d-flex align-items-center",style:{height:"105px"},children:(0,y.jsx)(b.A,{options:N,series:A,type:"scatter",height:"120"})})})]})]})})}),(0,y.jsx)(v.A,{md:4,className:"mt-3",children:(0,y.jsx)(i.A,{className:"bg-success",children:(0,y.jsxs)(p.A,{children:[(0,y.jsxs)("div",{className:"d-flex",children:[(0,y.jsx)("div",{className:"me-3 align-self-center",children:(0,y.jsx)("h1",{className:"text-dark-white",children:(0,y.jsx)("i",{className:"bi bi-pie-chart"})})}),(0,y.jsxs)("div",{children:[(0,y.jsx)("h4",{className:"text-dark-white",children:"Pengajuan Selesai"}),(0,y.jsxs)("h6",{className:"text-dark-white",children:["Tahun ",(new Date).getFullYear()]})]})]}),(0,y.jsxs)(g.A,{children:[(0,y.jsx)(v.A,{xs:5,className:"d-flex align-items-center",children:(0,y.jsx)("h1",{className:"text-dark-white text-truncate mb-0",children:n})}),(0,y.jsx)(v.A,{xs:7,className:"align-self-center",children:(0,y.jsx)("div",{className:"d-flex align-items-center",style:{height:"105px"},children:(0,y.jsx)(b.A,{options:N,series:A,type:"area",height:"120"})})})]})]})})}),(0,y.jsx)(v.A,{md:4,className:"mt-3",children:(0,y.jsx)(i.A,{className:"bg-info",children:(0,y.jsxs)(p.A,{children:[(0,y.jsxs)("div",{className:"d-flex",children:[(0,y.jsx)("div",{className:"me-3 align-self-center",children:(0,y.jsx)("h1",{className:"text-dark-white",children:(0,y.jsx)("i",{className:"bi bi-pie-chart"})})}),(0,y.jsxs)("div",{children:[(0,y.jsx)("h4",{className:"text-dark-white",children:"Total Pengajuan"}),(0,y.jsxs)("h6",{className:"text-dark-white",children:["Tahun ",(new Date).getFullYear()]})]})]}),(0,y.jsxs)(g.A,{children:[(0,y.jsx)(v.A,{xs:5,className:"d-flex align-items-center",children:(0,y.jsx)("h1",{className:"text-dark-white text-truncate mb-0",children:t})}),(0,y.jsx)(v.A,{xs:7,className:"align-self-center",children:(0,y.jsx)("div",{className:"d-flex align-items-center",style:{height:"105px"},children:(0,y.jsx)(b.A,{options:N,series:A,type:"line",height:"120"})})})]})]})})})]}),(0,y.jsx)(g.A,{className:"mt-4",children:(0,y.jsx)(v.A,{md:8,children:(0,y.jsx)(b.A,{options:(0,j.A)((0,j.A)({},f),{},{xaxis:{categories:l}}),series:r,type:"bar",height:"500"})})})]})})})};var k=n(3655),_=n(26259),S=n(7493),D=n(87426),P=n(23222),B=n(10591),C=n(20782),L=n(98268),F=n(64911),J=n(97877),T=n(55918),I=n.n(T),E=n(58786),R=n(24858),z=n(40028);const q=()=>{const e=(0,h.A)(),[a,n]=(0,t.useState)(!1),[s,l]=(0,t.useState)(!1),[r,c]=(0,t.useState)(""),[d,o]=(0,t.useState)([]),[u,x]=(0,t.useState)(!1),[b,N]=(0,t.useState)(!1),[A,f]=(0,t.useState)(null),[w,T]=(0,t.useState)(null),[q,M]=(0,t.useState)(!1),[O,K]=(0,t.useState)(""),[U,H]=(0,t.useState)({}),[G,Y]=(0,t.useState)({}),{register:V,handleSubmit:Q,reset:W,control:X,setValue:Z,watch:$,unregister:ee,formState:{errors:ae}}=(0,R.mN)({defaultValues:{items:[{itemName:"",quantity:"",unit:"",price:"",description:""}]}}),{fields:ne,append:te,remove:se}=(0,R.jz)({control:X,name:"items"}),{data:ie,isLoading:le,error:re,refetch:ce}=(0,m.I)({queryKey:["pengajuan-list"],queryFn:()=>e.get("api/pengajuan").then((e=>(console.log(e),e.data.data)))});(0,t.useEffect)((()=>{o(ie||[])}),[ie]),(0,t.useEffect)((()=>{let e=ie;var a,n;r&&(e=null===(a=e)||void 0===a?void 0:a.filter((e=>e.sub_pengajuan[0].nama_item.toLowerCase().includes(r.toLowerCase()))));O&&(e=null===(n=e)||void 0===n?void 0:n.filter((e=>{const a=new Date(e.created_at);return"".concat(a.getFullYear(),"-").concat(String(a.getMonth()+1).padStart(2,"0"))===O})));o(e)}),[r,O,ie]);const de=()=>{W(),M(!1),n(!1)};function oe(e){if(!e)return"Rp 0";const a=e.toString().replace(/[^,\d]/g,"").split(","),n=a[0].length%3;let t=a[0].substr(0,n);const s=a[0].substr(n).match(/\d{3}/g);if(s){t+="".concat(n?".":"").concat(s.join("."))}return"Rp ".concat(t)}const me=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0,useGrouping:!0}).format(e).replace(/,/g,""),ue=[{name:"Aksi",selector:a=>{var t;return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(_.A,{color:"danger",outline:!0,size:"sm",className:"me-2",onClick:()=>(e=>{M(!0),n(!0),Z("id",e.id),Z("jenis_permohonan",e.pengajuan),Z("documentNumber",e.no_dokumen),se(),H({}),Y({}),e.sub_pengajuan&&e.sub_pengajuan.length>0&&e.sub_pengajuan.forEach(((e,a)=>{te({itemName:e.nama_item,quantity:e.jumlah,unit:e.satuan,price:oe(e.biaya_satuan),description:e.keterangan,taxes:e.taxes&&Array.isArray(e.taxes)?e.taxes.map((e=>({name:e.nama_pajak,percentage:e.persentase,type:"increase"===e.calculation?"increment":"decrement"}))):[]}),e.taxes&&Array.isArray(e.taxes)&&e.taxes.length>0&&(H((e=>(0,j.A)((0,j.A)({},e),{},{[a]:!0}))),Y((n=>(0,j.A)((0,j.A)({},n),{},{[a]:e.taxes.map((e=>({id:"".concat(Date.now(),"-").concat(Math.random()),name:e.nama_pajak,percentage:e.persentase,type:"increase"===e.calculation?"increment":"decrement"})))}))))}))})(a),disabled:!(null!==a&&void 0!==a&&null!==(t=a.approvals)&&void 0!==t&&t.every((e=>{var n;return null===e.status||(null===a||void 0===a||null===(n=a.approvals)||void 0===n?void 0:n.some((e=>"0"===e.status)))}))),children:"Update"}),(0,y.jsx)(_.A,{color:"secondary",outline:!0,size:"sm",className:"me-2",onClick:()=>(async a=>{await e.get("api/pengajuan/".concat(a.id,"/show")).then((e=>{console.log("res",e),T(e.data.data),x(!0)})).catch((e=>{console.log(e),(0,z.x)("error","Terjadi Kesalahan")}))})(a),children:"Approval"}),(0,y.jsx)(_.A,{outline:!0,size:"sm",color:"info",onClick:()=>(a=>{f({row:a,title:"Detail Pengajuan",body:(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(g.A,{children:[(0,y.jsxs)(v.A,{md:6,children:[(0,y.jsx)("p",{className:"fw-bold",children:"Jenis Permohonan : "}),(0,y.jsx)("p",{children:a.pengajuan})]}),(0,y.jsxs)(v.A,{md:6,children:[(0,y.jsx)("p",{className:"fw-bold",children:"No Dokumen : "}),(0,y.jsx)("p",{children:a.no_dokumen})]})]}),(0,y.jsxs)(g.A,{children:[(0,y.jsxs)(v.A,{md:6,children:[(0,y.jsx)("p",{className:"fw-bold",children:"Tanggal Pengajuan : "}),(0,y.jsx)("p",{children:new Date(a.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(0,y.jsxs)(v.A,{md:6,children:[(0,y.jsx)("p",{className:"fw-bold",children:"Lampiran : "}),(0,y.jsx)("p",{children:(0,y.jsx)("a",{href:"".concat(e.defaults.baseURL,"/pengajuan/").concat(a.lampiran),target:"_blank",rel:"noopener noreferrer",className:"btn btn-info btn-sm",children:"Lihat Lampiran"})})]})]}),(0,y.jsx)(g.A,{children:(0,y.jsx)(v.A,{children:(0,y.jsx)("div",{className:"table-responsive",children:(0,y.jsxs)(k.A,{bordered:!0,responsive:!0,hover:!0,children:[(0,y.jsx)("thead",{children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{className:"text-center",style:{width:"50px"},children:"No"}),(0,y.jsx)("th",{children:"Nama Barang/Jasa"}),(0,y.jsx)("th",{children:"Jumlah"}),(0,y.jsx)("th",{children:"Satuan"}),(0,y.jsx)("th",{children:"Biaya Satuan"}),(0,y.jsx)("th",{children:"Pajak"}),(0,y.jsx)("th",{children:"Total Biaya"}),(0,y.jsx)("th",{children:"Keterangan"})]})}),(0,y.jsxs)("tbody",{children:[a.sub_pengajuan.map(((e,a)=>{const n=e.pajak||e.taxes||[],t=e.biaya_satuan,s=[];let i=t;n.forEach((a=>{const n=Number(a.persentase||a.percentage||0),l=a.calculation||a.type,r=a.nama_pajak||a.name||"";if(n>0){const a=t*n/100*e.jumlah,c=me(a);"increase"===l||"increment"===l?(i+=t*n/100,s.push((0,y.jsxs)("div",{children:["+ ".concat(r," (").concat(n,"%) : "),c]},"".concat(r,"_inc")))):"decrease"!==l&&"decrement"!==l||(i-=t*n/100,s.push((0,y.jsxs)("div",{children:["- ".concat(r," (").concat(n,"%) : "),c]},"".concat(r,"_dec"))))}}));const l=i*e.jumlah;return(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:"text-center",children:a+1}),(0,y.jsx)("td",{style:{whiteSpace:"pre-wrap"},children:e.nama_item}),(0,y.jsx)("td",{children:e.jumlah}),(0,y.jsx)("td",{children:e.satuan}),(0,y.jsx)("td",{children:me(e.biaya_satuan)}),(0,y.jsx)("td",{children:n.length>0?(0,y.jsx)("div",{children:n.map((a=>{const n=Number(a.persentase||a.percentage||0),s=a.calculation||a.type,i=a.nama_pajak||a.name||"",l=t*n/100*e.jumlah,r=me(l),c="".concat(i,"-").concat(s,"-").concat(n);return(0,y.jsxs)("div",{style:{marginBottom:4},children:[(0,y.jsxs)("span",{children:["increase"===s||"increment"===s?"+":"-"," ",i," (",n,"%) :"]}),(0,y.jsx)("br",{}),(0,y.jsx)("span",{style:{paddingLeft:16},children:r})]},c)}))}):(0,y.jsx)("span",{children:"-"})}),(0,y.jsx)("td",{children:me(l)}),(0,y.jsx)("td",{children:e.keterangan||"-"})]},e.id)})),(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{colSpan:6,className:"text-end fw-bold",children:"Total Biaya Keseluruhan"}),(0,y.jsx)("td",{colSpan:2,children:me(a.sub_pengajuan.reduce(((e,a)=>{const n=a.pajak||a.taxes||[],t=a.biaya_satuan;let s=t;return n.forEach((e=>{const a=Number(e.persentase||e.percentage||0),n=e.calculation||e.type;if(a>0){const e=t*a/100;"increase"===n||"increment"===n?s+=e:"decrease"!==n&&"decrement"!==n||(s-=e)}})),e+s*a.jumlah}),0))})]})]})]})})})})]})}),N(!0)})(a),children:"Detail"})]})},width:"300px"},{name:"Status",selector:e=>{var a,n;return(0,y.jsx)(y.Fragment,{children:null!==e&&void 0!==e&&null!==(a=e.approvals)&&void 0!==a&&a.every((e=>"1"===e.status))?(0,y.jsx)("span",{className:"badge bg-success rounded-pill",children:"Approved"}):null!==e&&void 0!==e&&null!==(n=e.approvals)&&void 0!==n&&n.some((e=>"0"===e.status))?(0,y.jsx)("span",{className:"badge bg-danger rounded-pill",children:"Rejected"}):(0,y.jsx)("span",{className:"badge bg-secondary rounded-pill",children:"Pending"})})}},{name:"Tanggal Pengajuan",selector:e=>new Date(e.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),width:"200px"},{name:"Jenis Permohonan",selector:e=>e.pengajuan},{name:"No Dokumen",selector:e=>e.no_dokumen,width:"200px"},{name:"Nama Barang/Jasa",selector:e=>e.sub_pengajuan[0].nama_item},{name:"Jumlah Barang/Jasa",selector:e=>e.sub_pengajuan[0].jumlah},{name:"Satuan",selector:e=>e.sub_pengajuan[0].satuan},{name:"Biaya Satuan",selector:e=>(0,y.jsx)("div",{children:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e.sub_pengajuan[0].biaya_satuan)})}],he=(e,a,n,t)=>{Y((s=>{const i=[...s[e]||[]];return i[a][n]=t,(0,j.A)((0,j.A)({},s),{},{[e]:i})}))};return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(i.A,{children:(0,y.jsxs)(p.A,{children:[!a&&(0,y.jsx)("div",{className:"d-grid gap-2",children:(0,y.jsx)(_.A,{size:"lg",color:"primary",onClick:async e=>{e.preventDefault(),n(!0)},children:"Tambah Permohonan"})}),a&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("div",{className:"d-flex justify-content-end mb-3",children:(0,y.jsx)(I(),{icon:"close",onClick:de,style:{cursor:"pointer"}})}),(0,y.jsxs)("form",{onSubmit:Q(q?async a=>{console.log("Data Submit",a),l(!0);const n=a.items.map((e=>{let a=[];return e.taxes&&Array.isArray(e.taxes)&&(a=e.taxes.map((e=>({name:e.name,percentage:Number(e.percentage),type:e.type})))),(0,j.A)((0,j.A)({},e),{},{price:Number(e.price.replace(/[^\d]/g,"")),taxes:a})})),t=new FormData;t.append("id",a.id),t.append("jenis_permohonan",a.jenis_permohonan),t.append("no_dokumen",a.documentNumber),a.file&&a.file[0]&&t.append("lampiran",a.file[0]),t.append("items",JSON.stringify(n)),await e.post("api/pengajuan/".concat(a.id,"/update"),t).then((e=>{ce(),console.log(e),l(!1),de(),W(),(0,z.x)("success","Pengajuan Berhasil Diupdate")})).catch((e=>{console.log(e),l(!1),(0,z.x)("error","Terjadi Kesalahan")}))}:async a=>{console.log("Data Submit",a),l(!0);const n=a.items.map((e=>{let a=[];return e.taxes&&Array.isArray(e.taxes)&&(a=e.taxes.map((e=>({name:e.name,percentage:Number(e.percentage),type:e.type})))),(0,j.A)((0,j.A)({},e),{},{price:Number(e.price.replace(/[^\d]/g,"")),taxes:a})})),t=new FormData;t.append("jenis_permohonan",a.jenis_permohonan),t.append("no_dokumen",a.documentNumber),t.append("lampiran",a.file[0]),t.append("items",JSON.stringify(n)),await e.post("api/pengajuan",t).then((e=>{console.log("res",e),l(!1),ce(),de(),W(),(0,z.x)("success","Pengajuan Berhasil Ditambahkan")})).catch((e=>{console.log(e),l(!1),(0,z.x)("error","Terjadi Kesalahan")}))}),children:[q&&(0,y.jsx)("input",(0,j.A)((0,j.A)({type:"hidden"},V("id")),{},{required:!0})),(0,y.jsxs)("div",{className:"row",children:[(0,y.jsx)("div",{className:"col-md-6",children:(0,y.jsxs)("div",{className:"mb-3",children:[(0,y.jsx)(S.A,{children:"Jenis Permohonan"}),(0,y.jsxs)("select",(0,j.A)((0,j.A)({className:"form-control ".concat(ae.jenis_permohonan?"is-invalid":"")},V("jenis_permohonan",{required:"Jenis Permohonan wajib diisi",onChange:e=>{return a=e.target.value,void Z("documentNumber","Permohonan Biaya"===a?"FPR-UM-PEMA-01-04":"Reimbursement"===a?"FPR-UM-PEMA-01-02":"Tagihan Biaya"===a?"FPR-UM-PEMA-01-03":"Aktual Biaya"===a?"FPR-UM-PEMA-04-02":"");var a}})),{},{children:[(0,y.jsx)("option",{value:"",children:"Pilih Permohonan"}),(0,y.jsx)("option",{value:"Permohonan Biaya",children:"Permohonan Biaya"}),(0,y.jsx)("option",{value:"Reimbursement",children:"Reimbursement"}),(0,y.jsx)("option",{value:"Tagihan Biaya",children:"Tagihan Biaya"}),(0,y.jsx)("option",{value:"Aktual Biaya",children:"Aktual Biaya"})]})),ae.jenis_permohonan&&(0,y.jsx)("div",{className:"invalid-feedback",children:ae.jenis_permohonan.message})]})}),(0,y.jsx)("div",{className:"col-md-6",children:(0,y.jsxs)("div",{className:"mb-3",children:[(0,y.jsx)(S.A,{children:"No Dokumen"}),(0,y.jsx)("input",(0,j.A)({type:"text",className:"form-control ".concat(ae.documentNumber?"is-invalid":""),placeholder:"No Dokumen"},V("documentNumber",{required:"No Dokumen wajib diisi"}))),ae.documentNumber&&(0,y.jsx)("div",{className:"invalid-feedback",children:ae.documentNumber.message})]})})]}),(0,y.jsx)("div",{className:"row",children:(0,y.jsx)("div",{className:"col-md-12",children:(0,y.jsxs)("div",{className:"mb-3",children:[(0,y.jsx)(S.A,{children:"Lampiran"}),(0,y.jsx)("input",(0,j.A)({type:"file",accept:".pdf",className:"form-control ".concat(ae.file?"is-invalid":""),placeholder:"Lampiran"},V("file",{required:!q&&"Lampiran wajib diisi"}))),(0,y.jsx)("span",{className:"text-primary",children:"Hanya menerima file PDF"}),ae.file&&(0,y.jsx)("div",{className:"invalid-feedback",children:ae.file.message})]})})}),(0,y.jsx)("div",{className:"row",children:(0,y.jsx)("div",{className:"col-md-12",children:(0,y.jsxs)("div",{className:"table-responsive",children:[(0,y.jsxs)("table",{className:"table table-bordered",children:[(0,y.jsx)("thead",{children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{style:{width:"300px"},children:"Nama Barang/Jasa"}),(0,y.jsx)("th",{style:{width:"150px"},children:"Jumlah"}),(0,y.jsx)("th",{style:{width:"200px"},children:"Satuan"}),(0,y.jsx)("th",{style:{width:"200px"},children:"Harga Satuan"}),(0,y.jsx)("th",{children:"Keterangan"}),(0,y.jsx)("th",{style:{width:"150px"},children:"Aksi"})]})}),(0,y.jsx)("tbody",{children:ne.map(((e,a)=>{var n,t,s,i,l,r,c,d,o,m,u,h,x,p,g,v;return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("tr",{children:[(0,y.jsxs)("td",{children:[(0,y.jsx)("textarea",(0,j.A)({className:"form-control ".concat(null!==(n=ae.items)&&void 0!==n&&null!==(t=n[a])&&void 0!==t&&t.itemName?"is-invalid":""),placeholder:"Nama Barang/Jasa"},V("items.".concat(a,".itemName"),{required:"Nama Barang/Jasa wajib diisi"}))),(null===(s=ae.items)||void 0===s||null===(i=s[a])||void 0===i?void 0:i.itemName)&&(0,y.jsx)("div",{className:"invalid-feedback",children:ae.items[a].itemName.message})]}),(0,y.jsxs)("td",{children:[(0,y.jsx)("input",(0,j.A)({type:"number",className:"form-control ".concat(null!==(l=ae.items)&&void 0!==l&&null!==(r=l[a])&&void 0!==r&&r.quantity?"is-invalid":""),placeholder:"Jumlah"},V("items.".concat(a,".quantity"),{required:"Jumlah wajib diisi"}))),(null===(c=ae.items)||void 0===c||null===(d=c[a])||void 0===d?void 0:d.quantity)&&(0,y.jsx)("div",{className:"invalid-feedback",children:ae.items[a].quantity.message})]}),(0,y.jsxs)("td",{children:[(0,y.jsx)("input",(0,j.A)({type:"text",className:"form-control ".concat(null!==(o=ae.items)&&void 0!==o&&null!==(m=o[a])&&void 0!==m&&m.unit?"is-invalid":""),placeholder:"Paket/Bulan/Kg/Unit, dll"},V("items.".concat(a,".unit"),{required:"Satuan wajib diisi"}))),(null===(u=ae.items)||void 0===u||null===(h=u[a])||void 0===h?void 0:h.unit)&&(0,y.jsx)("div",{className:"invalid-feedback",children:ae.items[a].unit.message})]}),(0,y.jsxs)("td",{children:[(0,y.jsx)("input",(0,j.A)((0,j.A)({type:"text",className:"form-control ".concat(null!==(x=ae.items)&&void 0!==x&&null!==(p=x[a])&&void 0!==p&&p.price?"is-invalid":""),placeholder:"Harga Satuan",value:oe($("items.".concat(a,".price"))||"")},V("items.".concat(a,".price"),{required:"Harga Satuan wajib diisi",validate:e=>{const a=e.replace(/[^\d]/g,"");return a?!(a<=0)||"Harga Satuan tidak boleh kurang dari atau sama dengan 0":"Harga Satuan wajib berupa angka"},onChange:e=>{const a=e.target.value.replace(/[^\d]/g,"");e.target.value=a}})),{},{autoComplete:"off"})),(null===(g=ae.items)||void 0===g||null===(v=g[a])||void 0===v?void 0:v.price)&&(0,y.jsx)("div",{className:"invalid-feedback",children:ae.items[a].price.message})]}),(0,y.jsx)("td",{children:(0,y.jsx)("textarea",(0,j.A)({className:"form-control",placeholder:"Keterangan"},V("items.".concat(a,".description"))))}),(0,y.jsxs)("td",{className:"text-center",children:[a>0&&(0,y.jsx)("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>se(a),children:"Hapus"}),(0,y.jsx)("button",{type:"button",className:"btn btn-outline-secondary btn-sm ms-2",onClick:()=>(e=>{H((a=>{const n=!a[e];return n?G[e]&&0!==G[e].length||Y((a=>(0,j.A)((0,j.A)({},a),{},{[e]:[{id:"".concat(Date.now(),"-").concat(Math.random()),name:"",percentage:"",type:"increment"}]}))):(G[e]&&Array.isArray(G[e])&&G[e].forEach(((a,n)=>{ee("items.".concat(e,".taxes.").concat(n,".name")),ee("items.".concat(e,".taxes.").concat(n,".percentage")),ee("items.".concat(e,".taxes.").concat(n,".type"))})),Y((a=>{const n=(0,j.A)({},a);return delete n[e],n}))),(0,j.A)((0,j.A)({},a),{},{[e]:n})}))})(a),children:"Pajak"})]})]},e.id),U[a]&&(0,y.jsx)("tr",{children:(0,y.jsxs)("td",{colSpan:6,children:[(G[a]||[]).map(((e,n)=>{var t,s,i,l,r,c,d,o,m,u,h,x,p,g,v,b,N,A,f,w,k,_,S,D;return(0,y.jsxs)("div",{className:"row mb-2",children:[(0,y.jsxs)("div",{className:"col-md-4",children:[(0,y.jsx)("input",(0,j.A)((0,j.A)({className:"form-control ".concat(null!==ae&&void 0!==ae&&null!==(t=ae.items)&&void 0!==t&&null!==(s=t[a])&&void 0!==s&&null!==(i=s.taxes)&&void 0!==i&&null!==(l=i[n])&&void 0!==l&&l.name?"is-invalid":""),placeholder:"Jenis Pajak"},V("items.".concat(a,".taxes.").concat(n,".name"),{required:"Jenis Pajak wajib diisi",onChange:e=>he(a,n,"name",e.target.value)})),{},{value:e.name})),(null===ae||void 0===ae||null===(r=ae.items)||void 0===r||null===(c=r[a])||void 0===c||null===(d=c.taxes)||void 0===d||null===(o=d[n])||void 0===o?void 0:o.name)&&(0,y.jsx)("div",{className:"invalid-feedback",children:ae.items[a].taxes[n].name.message})]}),(0,y.jsxs)("div",{className:"col-md-3",children:[(0,y.jsx)("input",(0,j.A)((0,j.A)({type:"number",className:"form-control ".concat(null!==ae&&void 0!==ae&&null!==(m=ae.items)&&void 0!==m&&null!==(u=m[a])&&void 0!==u&&null!==(h=u.taxes)&&void 0!==h&&null!==(x=h[n])&&void 0!==x&&x.percentage?"is-invalid":""),placeholder:"Persentase (%)"},V("items.".concat(a,".taxes.").concat(n,".percentage"),{required:"Persentase wajib diisi",validate:e=>!e||Number.isNaN(Number(e))?"Persentase wajib berupa angka":!(Number(e)<=0)||"Persentase tidak boleh kurang dari atau sama dengan 0",onChange:e=>he(a,n,"percentage",e.target.value)})),{},{value:e.percentage})),(null===ae||void 0===ae||null===(p=ae.items)||void 0===p||null===(g=p[a])||void 0===g||null===(v=g.taxes)||void 0===v||null===(b=v[n])||void 0===b?void 0:b.percentage)&&(0,y.jsx)("div",{className:"invalid-feedback",children:ae.items[a].taxes[n].percentage.message})]}),(0,y.jsxs)("div",{className:"col-md-3",children:[(0,y.jsxs)("select",(0,j.A)((0,j.A)({className:"form-control ".concat(null!==ae&&void 0!==ae&&null!==(N=ae.items)&&void 0!==N&&null!==(A=N[a])&&void 0!==A&&null!==(f=A.taxes)&&void 0!==f&&null!==(w=f[n])&&void 0!==w&&w.type?"is-invalid":"")},V("items.".concat(a,".taxes.").concat(n,".type"),{required:"Tipe wajib diisi",onChange:e=>he(a,n,"type",e.target.value)})),{},{value:e.type,children:[(0,y.jsx)("option",{value:"increment",children:"Increment"}),(0,y.jsx)("option",{value:"decrement",children:"Decrement"})]})),(null===ae||void 0===ae||null===(k=ae.items)||void 0===k||null===(_=k[a])||void 0===_||null===(S=_.taxes)||void 0===S||null===(D=S[n])||void 0===D?void 0:D.type)&&(0,y.jsx)("div",{className:"invalid-feedback",children:ae.items[a].taxes[n].type.message})]}),(0,y.jsx)("div",{className:"col-md-2",children:(0,y.jsx)("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>((e,a)=>{Y((n=>{const t=[...n[e]||[]];return t.splice(a,1),ee("items.".concat(e,".taxes.").concat(a,".name")),ee("items.".concat(e,".taxes.").concat(a,".percentage")),ee("items.".concat(e,".taxes.").concat(a,".type")),0===t.length?(H((a=>(0,j.A)((0,j.A)({},a),{},{[e]:!1}))),Object.fromEntries(Object.entries(n).filter((a=>{let[n]=a;return Number(n)!==e})))):(0,j.A)((0,j.A)({},n),{},{[e]:t})}))})(a,n),children:"Hapus"})})]},e.id)})),G[a]&&G[a].length>0&&(0,y.jsx)("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:()=>{return e=a,void Y((a=>{const n=a[e]||[];return(0,j.A)((0,j.A)({},a),{},{[e]:[...n,{id:"".concat(Date.now(),"-").concat(Math.random()),name:"",percentage:"",type:"increment"}]})}));var e},children:"Tambah Pajak"})]})})]})}))})]}),(0,y.jsx)("button",{type:"button",className:"btn btn-primary",onClick:()=>te({itemName:"",quantity:"",unit:"",price:"",description:""}),children:"Tambah Barang/Jasa"})]})})}),(0,y.jsx)("div",{className:"d-flex justify-content-end mb-3",children:(0,y.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:s,children:s?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(D.A,{color:"light",size:"sm",className:"me-1"})," Loading"]}):(0,y.jsx)(y.Fragment,{children:q?"Update":"Submit"})})})]})]})]})}),!a&&(0,y.jsx)(i.A,{children:(0,y.jsxs)(p.A,{children:[(0,y.jsxs)("div",{className:"mb-3 d-flex align-items-center justify-content-end",children:[(0,y.jsx)("input",{type:"text",className:"form-control w-25  me-2",placeholder:"Cari...",value:r,onChange:e=>c(e.target.value)}),(0,y.jsx)("input",{type:"month",className:"form-control w-auto",value:O,onChange:e=>K(e.target.value),style:{minWidth:180}})]}),le?(0,y.jsxs)("div",{className:"text-center",children:[(0,y.jsx)(D.A,{color:"primary",size:"sm",className:"me-2"})," Sedang Mengambil Data"]}):re?(0,y.jsx)("div",{className:"text-center",children:(0,y.jsx)("span",{className:"text-danger",children:"Something went wrong"})}):(0,y.jsx)(E.Ay,{columns:ue,data:d,pagination:!0,highlightOnHover:!0,responsive:!0,striped:!0})]})}),(0,y.jsxs)(P.A,{isOpen:u,toggle:()=>x(!u),children:[(0,y.jsx)(B.A,{toggle:()=>x(!u),children:"Approval Pengajuan"}),(0,y.jsx)(C.A,{children:w&&(0,y.jsx)(L.A,{flush:!0,children:w.map(((e,a)=>(0,y.jsxs)(F.A,{className:"d-flex justify-content-between align-items-start flex-column",children:[(0,y.jsxs)("div",{className:"w-100 d-flex justify-content-between align-items-center",children:[(0,y.jsxs)("div",{children:[(0,y.jsxs)("h6",{className:"mb-1",children:[(0,y.jsxs)("strong",{children:[a+1,"."]})," ",e.employe_id," - ",e.full_name]}),(0,y.jsx)("small",{className:"text-muted",children:e.position_name})]}),"1"===(null===e||void 0===e?void 0:e.status)?(0,y.jsxs)("div",{className:"d-flex flex-column align-items-end",children:[(0,y.jsx)("span",{className:"badge bg-success rounded-pill",children:"Approved"}),(0,y.jsx)("small",{className:"text-muted",children:new Date(null===e||void 0===e?void 0:e.updated_at).toLocaleString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}):"0"===(null===e||void 0===e?void 0:e.status)?(0,y.jsxs)("div",{className:"d-flex flex-column align-items-end",children:[(0,y.jsx)("span",{className:"badge bg-danger rounded-pill",children:"Rejected"}),(0,y.jsx)("small",{className:"text-muted",children:new Date(null===e||void 0===e?void 0:e.updated_at).toLocaleString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}):(0,y.jsx)("div",{className:"d-flex flex-column align-items-end",children:(0,y.jsx)("span",{className:"badge bg-secondary rounded-pill",children:"Pending"})})]}),"0"===(null===e||void 0===e?void 0:e.status)&&(null===e||void 0===e?void 0:e.keterangan)&&(0,y.jsx)("div",{className:"mt-2 w-100",children:(0,y.jsxs)("small",{children:[(0,y.jsx)("strong",{children:"Alasan Penolakan:"})," ",(0,y.jsx)("br",{}),e.keterangan]})})]})))})}),(0,y.jsx)(J.A,{children:(0,y.jsx)(_.A,{color:"secondary",onClick:()=>x(!1),children:"Tutup"})})]}),(0,y.jsxs)(P.A,{isOpen:b,toggle:()=>N(!b),size:"xl",children:[(0,y.jsx)(B.A,{toggle:()=>N(!b),children:"Detail Pengajuan"}),(0,y.jsx)(C.A,{children:null===A||void 0===A?void 0:A.body}),(0,y.jsx)(J.A,{children:(0,y.jsx)(_.A,{color:"secondary",onClick:()=>N(!1),children:"Tutup"})})]})]})};n(94727);const M=e=>{let{setBadgeCount:a}=e;const n=(0,h.A)(),[s,l]=(0,t.useState)([]),[r,c]=(0,t.useState)(!1),[d,o]=(0,t.useState)(null),[x,j]=(0,t.useState)(!1),[b,N]=(0,t.useState)(!1),[A,f]=(0,t.useState)(""),[w,L]=(0,t.useState)(!1),[F,T]=(0,t.useState)(""),I=(0,u.jE)(),R=()=>{c(!r),f(""),L(!1)},{data:q,isLoading:M,error:O,refetch:K}=(0,m.I)({queryKey:["approval-pengajuan-all"],queryFn:()=>n.get("api/pengajuan-approval").then((e=>e.data.data))});(0,t.useEffect)((()=>{l(q),q&&(a(null===q||void 0===q?void 0:q.length),I.invalidateQueries(["dashboard-pengajuan"]))}),[q,a]),(0,t.useEffect)((()=>{l(F?Array.isArray(q)?q.filter((e=>{var a,n,t;return(null===e||void 0===e?void 0:e.sub_pengajuan)&&Array.isArray(e.sub_pengajuan)&&(null===e||void 0===e||null===(a=e.sub_pengajuan[0])||void 0===a||null===(n=a.nama_item)||void 0===n||null===(t=n.toLowerCase())||void 0===t?void 0:t.includes(F.toLowerCase()))})):[]:Array.isArray(q)?q:[])}),[F,q]);const U=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0,useGrouping:!0}).format(e).replace(/,/g,""),H=[{name:"Aksi",selector:e=>(0,y.jsx)(_.A,{color:"primary",outline:!0,size:"sm",className:"me-2",onClick:()=>(e=>{o({row:e,title:"Detail Pengajuan",body:(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(g.A,{children:[(0,y.jsxs)(v.A,{md:6,children:[(0,y.jsx)("p",{className:"fw-bold",children:"Jenis Permohonan : "}),(0,y.jsx)("p",{children:e.pengajuan})]}),(0,y.jsxs)(v.A,{md:6,children:[(0,y.jsx)("p",{className:"fw-bold",children:"No Dokumen : "}),(0,y.jsx)("p",{children:e.no_dokumen})]})]}),(0,y.jsxs)(g.A,{children:[(0,y.jsxs)(v.A,{md:6,children:[(0,y.jsx)("p",{className:"fw-bold",children:"Tanggal Pengajuan : "}),(0,y.jsx)("p",{children:new Date(e.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(0,y.jsxs)(v.A,{md:6,children:[(0,y.jsx)("p",{className:"fw-bold",children:"Lampiran : "}),(0,y.jsx)("p",{children:(0,y.jsx)("a",{href:"".concat(n.defaults.baseURL,"/pengajuan/").concat(e.lampiran),target:"_blank",rel:"noopener noreferrer",className:"btn btn-info btn-sm",children:"Lihat Lampiran"})})]})]}),(0,y.jsx)(g.A,{children:(0,y.jsx)(v.A,{children:(0,y.jsx)("div",{className:"table-responsive",children:(0,y.jsxs)(k.A,{bordered:!0,responsive:!0,hover:!0,children:[(0,y.jsx)("thead",{children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{className:"text-center",style:{width:"50px"},children:"No"}),(0,y.jsx)("th",{children:"Nama Barang/Jasa"}),(0,y.jsx)("th",{children:"Jumlah"}),(0,y.jsx)("th",{children:"Satuan"}),(0,y.jsx)("th",{children:"Biaya Satuan"}),(0,y.jsx)("th",{children:"Pajak"}),(0,y.jsx)("th",{children:"Total Biaya"}),(0,y.jsx)("th",{children:"Keterangan"})]})}),(0,y.jsxs)("tbody",{children:[e.sub_pengajuan.map(((e,a)=>{const n=e.pajak||e.taxes||[],t=e.biaya_satuan,s=[];let i=t;n.forEach((a=>{const n=Number(a.persentase||a.percentage||0),l=a.calculation||a.type,r=a.nama_pajak||a.name||"";if(n>0){const a=t*n/100*e.jumlah,c=U(a);"increase"===l||"increment"===l?(i+=t*n/100,s.push((0,y.jsxs)("div",{children:["+ ".concat(r," (").concat(n,"%) : "),c]},"".concat(r,"_inc")))):"decrease"!==l&&"decrement"!==l||(i-=t*n/100,s.push((0,y.jsxs)("div",{children:["- ".concat(r," (").concat(n,"%) : "),c]},"".concat(r,"_dec"))))}}));const l=i*e.jumlah;return(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:"text-center",children:a+1}),(0,y.jsx)("td",{style:{whiteSpace:"pre-wrap"},children:e.nama_item}),(0,y.jsx)("td",{children:e.jumlah}),(0,y.jsx)("td",{children:e.satuan}),(0,y.jsx)("td",{children:U(e.biaya_satuan)}),(0,y.jsx)("td",{children:n.length>0?s:(0,y.jsx)("span",{children:"-"})}),(0,y.jsx)("td",{children:U(l)}),(0,y.jsx)("td",{children:e.keterangan||"-"})]},e.id)})),(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{colSpan:6,className:"text-end fw-bold",children:"Total Biaya Keseluruhan"}),(0,y.jsx)("td",{colSpan:2,children:U(e.sub_pengajuan.reduce(((e,a)=>{const n=a.pajak||a.taxes||[],t=a.biaya_satuan;let s=t;return n.forEach((e=>{const a=Number(e.persentase||e.percentage||0),n=e.calculation||e.type;if(a>0){const e=t*a/100;"increase"===n||"increment"===n?s+=e:"decrease"!==n&&"decrement"!==n||(s-=e)}})),e+s*a.jumlah}),0))})]})]})]})})})})]})}),c(!0)})(e),children:"Pending Approval"}),width:"200px"},{name:"Tanggal Pengajuan",selector:e=>new Date(null===e||void 0===e?void 0:e.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),width:"200px"},{name:"Jenis Permohonan",selector:e=>null===e||void 0===e?void 0:e.pengajuan,width:"250px"},{name:"No Dokumen",selector:e=>null===e||void 0===e?void 0:e.no_dokumen,width:"200px"},{name:"Nama Barang/Jasa",selector:e=>{var a;return null===e||void 0===e||null===(a=e.sub_pengajuan[0])||void 0===a?void 0:a.nama_item}},{name:"Jumlah Barang/Jasa",selector:e=>{var a;return null===e||void 0===e||null===(a=e.sub_pengajuan[0])||void 0===a?void 0:a.jumlah}},{name:"Satuan",selector:e=>{var a;return null===e||void 0===e||null===(a=e.sub_pengajuan[0])||void 0===a?void 0:a.satuan}},{name:"Biaya Satuan",selector:e=>{var a;return(0,y.jsx)("div",{children:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(null===e||void 0===e||null===(a=e.sub_pengajuan[0])||void 0===a?void 0:a.biaya_satuan)})}}];return(0,y.jsxs)("div",{children:[(0,y.jsx)(i.A,{children:(0,y.jsxs)(p.A,{className:"p-4",children:[(0,y.jsx)("div",{className:"mb-3 d-flex align-items-center justify-content-end",children:(0,y.jsx)("input",{type:"text",className:"form-control w-25",placeholder:"Cari...",value:F,onChange:e=>T(e.target.value)})}),M?(0,y.jsxs)("div",{className:"d-flex justify-content-center",children:[(0,y.jsx)(D.A,{color:"primary",size:"sm",className:"me-2"})," Sedang Mengambil Data"]}):O?(0,y.jsx)("div",{className:"text-center",children:"Something went wrong"}):0===(null===s||void 0===s?void 0:s.length)?(0,y.jsx)("div",{className:"text-center",children:"Tidak ada data pengajuan"}):(0,y.jsx)(E.Ay,{columns:H,data:s,pagination:!0,highlightOnHover:!0})]})}),(0,y.jsxs)(P.A,{isOpen:r,toggle:R,size:"xl",children:[(0,y.jsx)(B.A,{toggle:R,children:(null===d||void 0===d?void 0:d.title)||"Detail"}),(0,y.jsxs)(C.A,{children:[null===d||void 0===d?void 0:d.body,w&&(0,y.jsxs)("div",{className:"mt-3",children:[(0,y.jsx)(S.A,{children:(0,y.jsx)("strong",{children:"Alasan Penolakan:"})}),(0,y.jsx)("textarea",{className:"form-control",rows:"3",value:A,onChange:e=>f(e.target.value),placeholder:"Masukkan alasan penolakan"})]})]}),(0,y.jsxs)(J.A,{children:[(0,y.jsx)(_.A,{color:"secondary",onClick:R,children:"Tutup"}),w?(0,y.jsx)(_.A,{color:"danger",onClick:async()=>{if(null===d||void 0===d||!d.row)return;if(!A.trim())return void(0,z.x)("error","Silakan isi alasan penolakan");N(!0);const e={id:d.row.id,status:"reject",alasan:A};try{await n.post("api/pengajuan-approval/reject",e),K(),c(!1),f(""),L(!1),(0,z.x)("success","Pengajuan Ditolak")}catch(a){console.error(a),(0,z.x)("error","Terjadi kesalahan")}finally{N(!1)}},disabled:b,children:b?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(D.A,{size:"sm",color:"light",className:"me-2"})," Loading"]}):"Submit Reject"}):(0,y.jsx)(_.A,{color:"danger",onClick:()=>L(!0),children:"Reject"}),(0,y.jsx)(_.A,{color:"primary",onClick:async()=>{if(null===d||void 0===d||!d.row)return;j(!0);const e={id:d.row.id,status:"approve"};try{await n.post("api/pengajuan-approval/approve",e),K(),c(!1),(0,z.x)("success","Pengajuan berhasil diapprove")}catch(a){console.error(a),(0,z.x)("error","Terjadi kesalahan")}finally{j(!1)}},disabled:x,children:x?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(D.A,{size:"sm",color:"light",className:"me-2"})," Loading"]}):"Approve"})]})]})]})};var O=n(54211),K=n.n(O),U=n(86947),H=n.n(U);H()&&H().pdfMake?K().vfs=H().pdfMake.vfs:console.error("Failed to load pdfmake fonts. Ensure pdfmake is properly installed.");const G=()=>{const e=(0,h.A)(),[a,n]=(0,t.useState)([]),[s,l]=(0,t.useState)(""),[r,c]=(0,t.useState)(""),[d,o]=(0,t.useState)(null),[u,x]=(0,t.useState)(!1),{data:j,isLoading:b,error:N}=(0,m.I)({queryKey:["pengajuanSelesai"],queryFn:()=>e.get("/api/pengajuan-selesai").then((e=>(console.log(e),e.data.data)))});(0,t.useEffect)((()=>{n(j||[])}),[j]),(0,t.useEffect)((()=>{let e=j;var a,t;s&&(e=null===(a=e)||void 0===a?void 0:a.filter((e=>e.sub_pengajuan[0].nama_item.toLowerCase().includes(s.toLowerCase()))));r&&(e=null===(t=e)||void 0===t?void 0:t.filter((e=>{const a=new Date(e.created_at),n=String(a.getMonth()+1).padStart(2,"0"),t=a.getFullYear();return r==="".concat(t,"-").concat(n)})));n(e)}),[s,r,j]);const A=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0,useGrouping:!0}).format(e).replace(/,/g,""),f=a=>{var n;o({row:a,title:"Detail Pengajuan",body:(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("div",{className:"d-flex justify-content-end",children:(0,y.jsx)(_.A,{color:"primary",onClick:()=>(a=>{const n={content:[{text:"Detail Pengajuan",style:"header"},{text:"Jenis Permohonan: ".concat(a.pengajuan),margin:[0,10,0,5]},{text:"No Dokumen: ".concat(a.no_dokumen),margin:[0,0,0,5]},{text:"Tanggal Pengajuan: ".concat(new Date(a.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})),margin:[0,0,0,10]},{text:"Lampiran:",margin:[0,0,0,5]},{text:"".concat(e.defaults.baseURL,"/pengajuan/").concat(a.lampiran),link:"".concat(e.defaults.baseURL,"/pengajuan/").concat(a.lampiran),color:"blue",margin:[0,0,0,10]},{text:"Diapprove oleh:",style:"subheader",margin:[0,10,0,5]},...a.approvals.map((e=>({text:"".concat(e.full_name," (").concat(e.position_name,") - Approved At: ").concat(new Date(e.updated_at).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})),margin:[0,0,0,5]}))),{text:"Detail Barang/Jasa:",style:"subheader",margin:[0,10,0,5]},{table:{headerRows:1,widths:["auto","*","auto","auto","auto","auto","auto","*"],body:[[{text:"No",bold:!0,alignment:"center"},{text:"Nama Barang/Jasa",bold:!0},{text:"Jumlah",bold:!0},{text:"Satuan",bold:!0},{text:"Biaya Satuan",bold:!0},{text:"Pajak",bold:!0},{text:"Total Biaya",bold:!0},{text:"Keterangan",bold:!0}],...a.sub_pengajuan.map(((e,a)=>{const n=e.pajak||e.taxes||[],t=e.biaya_satuan;let s=t;const i=n.map((a=>{const n=Number(a.persentase||a.percentage||0),i=a.calculation||a.type,l=a.nama_pajak||a.name||"",r=t*n/100*e.jumlah,c=A(r);return"increase"===i||"increment"===i?(s+=t*n/100,"+ ".concat(l,"\n(").concat(n,"%) :\n ").concat(c)):"decrease"===i||"decrement"===i?(s-=t*n/100,"- ".concat(l,"\n(").concat(n,"%) :\n ").concat(c)):""})),l=s*e.jumlah;return[{text:a+1,alignment:"center"},{text:e.nama_item},{text:e.jumlah,alignment:"center"},{text:e.satuan,alignment:"center"},{text:A(e.biaya_satuan),alignment:"right"},n.length>0?{text:i.join("\n"),alignment:"left"}:{text:"-",alignment:"center"},{text:A(l),alignment:"right"},{text:e.keterangan||"-",alignment:"left"}]})),[{text:"Total Biaya Keseluruhan",colSpan:6,alignment:"right"},{},{},{},{},{},A(a.sub_pengajuan.reduce(((e,a)=>{const n=a.pajak||a.taxes||[];let t=a.biaya_satuan;return n.forEach((e=>{const n=Number(e.persentase||e.percentage||0),s=e.calculation||e.type;if(n>0){const e=a.biaya_satuan*n/100;"increase"!==s&&"increment"!==s||(t+=e),"decrease"!==s&&"decrement"!==s||(t-=e)}})),e+t*a.jumlah}),0)),{}]]}}],styles:{header:{fontSize:18,bold:!0},subheader:{fontSize:14,bold:!0}}};K().createPdf(n).open()})(a),children:"Print PDF"})}),(0,y.jsxs)(g.A,{className:"mb-4",children:[(0,y.jsxs)(v.A,{md:6,children:[(0,y.jsx)("p",{className:"fw-bold",children:"Jenis Permohonan:"}),(0,y.jsx)("p",{children:a.pengajuan})]}),(0,y.jsxs)(v.A,{md:6,children:[(0,y.jsx)("p",{className:"fw-bold",children:"No Dokumen:"}),(0,y.jsx)("p",{children:a.no_dokumen})]})]}),(0,y.jsxs)(g.A,{className:"mb-4",children:[(0,y.jsxs)(v.A,{md:6,children:[(0,y.jsx)("p",{className:"fw-bold",children:"Tanggal Pengajuan:"}),(0,y.jsx)("p",{children:new Date(a.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(0,y.jsxs)(v.A,{md:6,children:[(0,y.jsx)("p",{className:"fw-bold",children:"Lampiran:"}),(0,y.jsx)("p",{children:(0,y.jsx)("a",{href:"".concat(e.defaults.baseURL,"/pengajuan/").concat(a.lampiran),target:"_blank",rel:"noopener noreferrer",className:"btn btn-info btn-sm",children:"Lihat Lampiran"})})]})]}),(0,y.jsxs)(g.A,{className:"mb-4",children:[(0,y.jsx)("p",{className:"fw-bold",children:"Diapprove oleh:"}),null===a||void 0===a||null===(n=a.approvals)||void 0===n?void 0:n.map((e=>(0,y.jsx)(v.A,{md:4,className:"mb-3",children:(0,y.jsxs)("div",{className:"shadow-sm p-3 bg-light rounded",children:[(0,y.jsx)("h5",{className:"mb-1",children:null===e||void 0===e?void 0:e.full_name}),(0,y.jsx)("p",{className:"mb-1 text-muted",children:e.position_name}),(0,y.jsxs)("small",{className:"text-muted",children:[(0,y.jsx)("strong",{children:"Approved At: "}),new Date(e.updated_at).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})},e.id)))]}),(0,y.jsx)(g.A,{children:(0,y.jsx)(v.A,{children:(0,y.jsx)("div",{className:"table-responsive",children:(0,y.jsxs)(k.A,{bordered:!0,responsive:!0,hover:!0,children:[(0,y.jsx)("thead",{children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{className:"text-center",style:{width:"50px"},children:"No"}),(0,y.jsx)("th",{children:"Nama Barang/Jasa"}),(0,y.jsx)("th",{children:"Jumlah"}),(0,y.jsx)("th",{children:"Satuan"}),(0,y.jsx)("th",{children:"Biaya Satuan"}),(0,y.jsx)("th",{children:"Pajak"}),(0,y.jsx)("th",{children:"Total Biaya"}),(0,y.jsx)("th",{children:"Keterangan"})]})}),(0,y.jsxs)("tbody",{children:[a.sub_pengajuan.map(((e,a)=>{const n=e.pajak||e.taxes||[],t=e.biaya_satuan,s=[];let i=t;n.forEach((a=>{const n=Number(a.persentase||a.percentage||0),l=a.calculation||a.type,r=a.nama_pajak||a.name||"";if(n>0){const a=t*n/100*e.jumlah,c=A(a);"increase"===l||"increment"===l?(i+=t*n/100,s.push((0,y.jsxs)("div",{children:["+ ".concat(r," (").concat(n,"%) : "),c]},"".concat(r,"_inc")))):"decrease"!==l&&"decrement"!==l||(i-=t*n/100,s.push((0,y.jsxs)("div",{children:["- ".concat(r," (").concat(n,"%) : "),c]},"".concat(r,"_dec"))))}}));const l=i*e.jumlah;return(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:"text-center",children:a+1}),(0,y.jsx)("td",{style:{whiteSpace:"pre-wrap"},children:e.nama_item}),(0,y.jsx)("td",{children:e.jumlah}),(0,y.jsx)("td",{children:e.satuan}),(0,y.jsx)("td",{children:A(e.biaya_satuan)}),(0,y.jsx)("td",{children:n.length>0?s:(0,y.jsx)("span",{children:"-"})}),(0,y.jsx)("td",{children:A(l)}),(0,y.jsx)("td",{children:e.keterangan||"-"})]},e.id)})),(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{colSpan:6,className:"text-end fw-bold",children:"Total Biaya Keseluruhan"}),(0,y.jsx)("td",{colSpan:2,children:A(a.sub_pengajuan.reduce(((e,a)=>{const n=a.pajak||a.taxes||[],t=a.biaya_satuan;let s=t;return n.forEach((e=>{const a=Number(e.persentase||e.percentage||0),n=e.calculation||e.type;if(a>0){const e=t*a/100;"increase"===n||"increment"===n?s+=e:"decrease"!==n&&"decrement"!==n||(s-=e)}})),e+s*a.jumlah}),0))})]})]})]})})})})]})}),x(!0)},w=[{name:"No",selector:(e,a)=>a+1,width:"50px"},{name:"Aksi",selector:e=>(0,y.jsx)("div",{className:"d-flex justify-content-center",children:(0,y.jsx)(_.A,{outline:!0,color:"info",size:"sm",onClick:()=>f(e),children:"Detail"})})},{name:"Tanggal Pengajuan",selector:e=>new Date(e.created_at).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),width:"200px"},{name:"Jenis Permohonan",selector:e=>e.pengajuan,width:"250px"},{name:"No Dokumen",selector:e=>e.no_dokumen,width:"200px"},{name:"Nama Barang/Jasa",selector:e=>e.sub_pengajuan[0].nama_item},{name:"Jumlah Barang/Jasa",selector:e=>e.sub_pengajuan[0].jumlah},{name:"Satuan",selector:e=>e.sub_pengajuan[0].satuan},{name:"Biaya Satuan",selector:e=>(0,y.jsx)("div",{children:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e.sub_pengajuan[0].biaya_satuan)})}];return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(i.A,{children:(0,y.jsxs)(p.A,{children:[(0,y.jsxs)("div",{className:"mb-3 d-flex align-items-center justify-content-end gap-2",children:[(0,y.jsx)("input",{type:"text",className:"form-control w-25",placeholder:"Cari...",value:s,onChange:e=>l(e.target.value)}),(0,y.jsx)("input",{type:"month",className:"form-control w-auto",value:r,onChange:e=>c(e.target.value),style:{minWidth:180}})]}),b?(0,y.jsxs)("div",{className:"d-flex justify-content-center",children:[(0,y.jsx)(D.A,{color:"primary",size:"sm",className:"me-2"})," Sedang Mengambil Data"]}):N?(0,y.jsx)("div",{className:"text-center",children:"Something went wrong"}):(0,y.jsx)(E.Ay,{columns:w,data:a,pagination:!0,highlightOnHover:!0})]})}),(0,y.jsxs)(P.A,{isOpen:u,toggle:()=>x(!u),size:"xl",children:[(0,y.jsx)(B.A,{toggle:()=>x(!u),children:"Detail Pengajuan"}),(0,y.jsx)(C.A,{children:null===d||void 0===d?void 0:d.body}),(0,y.jsx)(J.A,{children:(0,y.jsx)(_.A,{color:"secondary",onClick:()=>x(!1),children:"Tutup"})})]})]})},Y=()=>{const e=(0,h.A)(),a=(0,s.zy)(),[n,j]=(0,t.useState)([]),{data:p}=(0,m.I)(["dashboard-pengajuan"],(()=>e.get("/api/pengajuan-dashboard").then((e=>e.data.data)))),{data:g}=(0,m.I)(["chart-pengajuan"],(()=>e.get("/api/pengajuan-dashboard/chart").then((e=>(console.log("Data Chart",e.data.data),e.data.data)))));(0,t.useEffect)((()=>{p&&j(p)}),[p]);const v=JSON.parse(localStorage.getItem("auth")),b=(0,u.jE)(),[N,A]=(0,t.useState)("1"),[f,k]=(0,t.useState)(0);(0,t.useEffect)((()=>{b.invalidateQueries(["approval-pengajuan-all"])}),[]);return(0,t.useEffect)((()=>{"approval"===new URLSearchParams(a.search).get("tab")&&A("3")}),[a]),(0,y.jsxs)("div",{children:[(0,y.jsx)(x.A,{}),(0,y.jsxs)(l.Ay,{value:N,children:[(0,y.jsx)(i.A,{className:"mb-1",children:(0,y.jsxs)(r.A,{onChange:(e,a)=>{A(a)},vertical:"sm",variant:"scrollable",scrollButtons:"auto",children:[(0,y.jsx)(d.A,{label:(0,y.jsxs)(o.A,{badgeContent:0,anchorOrigin:{vertical:"top",horizontal:"right"},color:"primary",children:[(0,y.jsx)("strong",{children:"DASHBOARD"})," \xa0\xa0"]}),value:"1"}),(null===v||void 0===v?void 0:v.user.roles.includes("AdminPengajuan"))&&(0,y.jsx)(d.A,{label:(0,y.jsxs)(o.A,{badgeContent:0,anchorOrigin:{vertical:"top",horizontal:"right"},color:"primary ",children:[(0,y.jsx)("strong",{children:"PENGAJUAN"})," \xa0\xa0"]}),value:"2"}),((null===v||void 0===v?void 0:v.user.roles.includes("ManagerUmum"))||(null===v||void 0===v?void 0:v.user.roles.includes("DirekturUmumKeuangan"))||(null===v||void 0===v?void 0:v.user.roles.includes("Presdir")))&&(0,y.jsx)(d.A,{label:(0,y.jsxs)(o.A,{badgeContent:(f>99?"99+":f)||((null===n||void 0===n?void 0:n.total_pengajuan_belum_selesai)>99?"99+":null===n||void 0===n?void 0:n.total_pengajuan_belum_selesai),anchorOrigin:{vertical:"top",horizontal:"right"},color:"warning",style:{textTransform:"capitalize"},children:[(0,y.jsx)("strong",{children:"APPROVAL PENGAJUAN"})," \xa0\xa0"]}),value:"3"}),(0,y.jsx)(d.A,{label:(0,y.jsxs)(o.A,{badgeContent:0,anchorOrigin:{vertical:"top",horizontal:"right"},color:"primary",children:[(0,y.jsx)("strong",{children:"PENGAJUAN SELESAI"})," \xa0\xa0"]}),value:"4"})]})}),(0,y.jsx)(c.A,{value:"1",className:"ps-0 pe-0",children:(0,y.jsx)(w,{diproses:null===n||void 0===n?void 0:n.total_pengajuan_belum_selesai,selesai:null===n||void 0===n?void 0:n.total_pengajuan_selesai,totalPengajuan:null===n||void 0===n?void 0:n.total_pengajuan,dataChart:g})}),(0,y.jsx)(c.A,{value:"2",className:"ps-0 pe-0",children:(0,y.jsx)(q,{})}),(0,y.jsx)(c.A,{value:"3",className:"ps-0 pe-0",children:(0,y.jsx)(M,{setBadgeCount:k})}),(0,y.jsxs)(c.A,{value:"4",className:"ps-0 pe-0",children:[(0,y.jsx)(G,{})," "]})]})]})}}}]);
//# sourceMappingURL=2940.870d932c.chunk.js.map