(self.webpackChunkmaterialpro_main=self.webpackChunkmaterialpro_main||[]).push([[637],{80544:(e,s,t)=>{"use strict";t.d(s,{A:()=>l});t(65043);var i=t(70579);const l=e=>{let{data:s,color:t}=e;return(0,i.jsx)("div",{className:"flex-wrapper",children:(0,i.jsx)("div",{className:"single-chart",children:(0,i.jsxs)("svg",{viewBox:"0 0 36 36",className:"circular-chart ".concat(100===s?"green":100!==s?"blue":t),children:[(0,i.jsx)("path",{className:"circle-bg",d:"M18 2.0845\r a 15.9155 15.9155 0 0 1 0 31.831\r a 15.9155 15.9155 0 0 1 0 -31.831"}),(0,i.jsx)("path",{className:"circle",strokeDasharray:"".concat(s,", 100"),d:"M18 2.0845\r a 15.9155 15.9155 0 0 1 0 31.831\r a 15.9155 15.9155 0 0 1 0 -31.831"}),100===s?(0,i.jsx)("text",{x:"18",y:"22.35",className:"percentage",style:{fontSize:"14px"},children:"\u2714"}):(0,i.jsxs)("text",{x:"18",y:"22.35",className:"percentage",children:[s,"%"]})]})})})}},66230:(e,s,t)=>{"use strict";t.d(s,{A:()=>r});var i=t(89379),l=t(65043),n=t(96316),a=t(70579);const d=n.vv.create({body:{paddingTop:35,paddingBottom:65,paddingHorizontal:35},title:{fontSize:10,textAlign:"center"},text:{margin:10,fontSize:10,textAlign:"justify"},image:{marginVertical:4,marginHorizontal:15,width:50,height:50},header:{fontSize:10,marginBottom:5,textAlign:"left",color:"#3f3f3f",fontWeight:"bold"},pageNumber:{position:"absolute",fontSize:10,bottom:30,left:0,right:0,textAlign:"center",color:"grey"},printAt:{position:"absolute",fontSize:8,bottom:30,left:35,right:0,textAlign:"left",color:"grey"},table:{display:"table",width:"auto",borderStyle:"solid",borderWidth:1,borderRightWidth:0,borderBottomWidth:0,color:"#3f3f3f"},tableRow:{margin:"auto",flexDirection:"row"},tableCol:{borderStyle:"solid",borderWidth:1,borderLeftWidth:0,borderTopWidth:0},tableCell:{marginTop:3,marginBottom:3,marginLeft:3,marginRight:3,fontSize:10}}),c=()=>{const e=new Date;return"".concat(e.toDateString(),", ").concat(e.toLocaleString().split(",")[1])},r=e=>{let{projectTitle:s,data:t}=e;return(0,a.jsx)(n.yo,{children:(0,a.jsxs)(n.YW,{style:(0,i.A)((0,i.A)({},d.body),{},{backgroundColor:"#fff"}),children:[(0,a.jsxs)(n.EY,{style:d.header,fixed:!0,children:["Project : ",null===s||void 0===s?void 0:s.project_name]}),(0,a.jsxs)(n.EY,{style:d.header,fixed:!0,children:["Partner : ",null===s||void 0===s?void 0:s.partner]}),(0,a.jsxs)(n.EY,{style:d.header,fixed:!0,children:["Division : ",null===s||void 0===s?void 0:s.division]}),(0,a.jsxs)(n.EY,{style:d.header,fixed:!0,children:["Phase : ",null===s||void 0===s?void 0:s.phase]}),(0,a.jsxs)(n.EY,{style:d.header,fixed:!0,children:["Schema : ","jo"===(null===s||void 0===s?void 0:s.schema)?"Join Operational":"Join Venture"]}),(0,a.jsxs)(n.Ss,{style:d.table,children:[(0,a.jsxs)(n.Ss,{style:d.tableRow,children:[(0,a.jsx)(n.Ss,{style:(0,i.A)((0,i.A)({},d.tableCol),{},{width:"5%"}),children:(0,a.jsx)(n.EY,{style:d.tableCell,children:"No."})}),(0,a.jsx)(n.Ss,{style:(0,i.A)((0,i.A)({},d.tableCol),{},{width:"35%"}),children:(0,a.jsx)(n.EY,{style:d.tableCell,children:"Task Title"})}),(0,a.jsx)(n.Ss,{style:(0,i.A)((0,i.A)({},d.tableCol),{},{width:"15%"}),children:(0,a.jsx)(n.EY,{style:d.tableCell,children:"Status"})}),(0,a.jsx)(n.Ss,{style:(0,i.A)((0,i.A)({},d.tableCol),{},{width:"15%"}),children:(0,a.jsx)(n.EY,{style:d.tableCell,children:"Deadline"})}),(0,a.jsx)(n.Ss,{style:(0,i.A)((0,i.A)({},d.tableCol),{},{width:"30%"}),children:(0,a.jsx)(n.EY,{style:d.tableCell,children:"PIC"})})]}),null===t||void 0===t?void 0:t.map(((e,s)=>{var t,c;return(0,a.jsxs)(l.Fragment,{children:[(0,a.jsxs)(n.Ss,{style:d.tableRow,children:[(0,a.jsx)(n.Ss,{style:(0,i.A)((0,i.A)({},d.tableCol),{},{width:"5%"}),children:(0,a.jsx)(n.EY,{style:(0,i.A)((0,i.A)({},d.tableCell),{},{textAlign:"center"}),children:s+1})}),(0,a.jsx)(n.Ss,{style:(0,i.A)((0,i.A)({},d.tableCol),{},{width:"35%"}),children:(0,a.jsx)(n.EY,{style:d.tableCell,children:e.task_title})}),(0,a.jsx)(n.Ss,{style:(0,i.A)((0,i.A)({},d.tableCol),{},{width:"15%"}),children:(0,a.jsx)(n.EY,{style:(0,i.A)((0,i.A)({},d.tableCell),{},{fontSize:"10px"}),children:0===e.status?"To do":1===e.status?"In progress":2===e.status?"Under review":3===e.status?"Approved":"Revision"})}),(0,a.jsx)(n.Ss,{style:(0,i.A)((0,i.A)({},d.tableCol),{},{width:"15%"}),children:(0,a.jsx)(n.EY,{style:d.tableCell,children:e.end_date})}),(0,a.jsx)(n.Ss,{style:(0,i.A)((0,i.A)({},d.tableCol),{},{width:"30%"}),children:null===(t=e.pics)||void 0===t?void 0:t.map((e=>(0,a.jsx)(n.EY,{style:d.tableCell,children:e.first_name},e.id)))})]}),null===(c=e.level_2)||void 0===c?void 0:c.map((e=>{var s;return(0,a.jsxs)(n.Ss,{style:d.tableRow,children:[(0,a.jsx)(n.Ss,{style:(0,i.A)((0,i.A)({},d.tableCol),{},{width:"5%"}),children:(0,a.jsx)(n.EY,{style:d.tableCell})}),(0,a.jsx)(n.Ss,{style:(0,i.A)((0,i.A)({},d.tableCol),{},{width:"35%"}),children:(0,a.jsx)(n.EY,{style:d.tableCell,children:e.task_title})}),(0,a.jsx)(n.Ss,{style:(0,i.A)((0,i.A)({},d.tableCol),{},{width:"15%"}),children:(0,a.jsx)(n.EY,{style:d.tableCell,children:"-"})}),(0,a.jsx)(n.Ss,{style:(0,i.A)((0,i.A)({},d.tableCol),{},{width:"15%"}),children:(0,a.jsx)(n.EY,{style:d.tableCell,children:e.end_date})}),(0,a.jsx)(n.Ss,{style:(0,i.A)((0,i.A)({},d.tableCol),{},{width:"30%"}),children:null===(s=e.pics)||void 0===s?void 0:s.map((e=>(0,a.jsx)(n.EY,{style:d.tableCell,children:e.first_name},e.id)))})]},e.task_id)}))]},e.task_id)}))]}),(0,a.jsx)(n.EY,{style:d.pageNumber,render:e=>{let{pageNumber:s,totalPages:t}=e;return"".concat(s," / ").concat(t)}}),(0,a.jsx)(n.EY,{style:d.printAt,render:c})]})})}},73602:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>ze});var i=t(65043),l=t(22345),n=t(49157),a=t(18353),d=t(12327),c=t(35299),r=t(50772),o=t(26259),h=t(23222),x=t(10591),u=t(20782),m=t(97550),j=t(7493),v=t(72679),p=t(97877),g=t(87426),f=t(203),b=t(55918),A=t.n(b),y=t(73216),_=t(35475),N=t(91014),S=t(72738),w=t(29820),k=t(93397),C=t(18707),z=t(30342),I=t(40028),F=t(30757),E=t(49026),D=t(80519),R=t(70579);const T=(0,S.Ay)(),L=e=>{const s=(new Date).toLocaleString().split(",")[0],t=s.split("/")[1],i=s.split("/")[0],l=s.split("/")[2],n="".concat(l,"-").concat(i,"-").concat(t),a=new Date(n);return(new Date(e).getTime()-a.getTime())/864e5},M=()=>{var e,s,t,b,S,M;const{auth:P}=(0,z.A)(),{projectId:O}=(0,y.g)(),[B,Y]=(0,i.useState)(),[V,q]=(0,i.useState)(!1),[W,J]=(0,i.useState)(),[H,K]=(0,i.useState)(),[U,Z]=(0,i.useState)(!1),[G,X]=(0,i.useState)([]),[Q,$]=(0,i.useState)(void 0),[ee,se]=(0,i.useState)(""),[te,ie]=(0,i.useState)(),[le,ne]=(0,i.useState)([]),[ae,de]=(0,i.useState)(void 0),[ce,re]=(0,i.useState)(0),[oe,he]=(0,i.useState)({todo:0,inprogress:0,underReview:0,done:0}),xe=(0,k.A)(),ue=()=>{q(!V)},{isLoading:me,error:je,data:ve,refetch:pe}=(0,f.I)({queryKey:["overview"],queryFn:()=>xe.get("api/project/".concat(O)).then((e=>e.data.data))});(0,i.useEffect)((()=>{var e,s,t,i,l;const n=null===ve||void 0===ve||null===(e=ve.task_by_active_user)||void 0===e?void 0:e.filter((e=>0===parseInt(e.status,10)||4===parseInt(e.status,10))),a=null===ve||void 0===ve||null===(s=ve.task_by_active_user)||void 0===s?void 0:s.filter((e=>1===parseInt(e.status,10))),d=null===ve||void 0===ve||null===(t=ve.task_by_active_user)||void 0===t?void 0:t.filter((e=>2===parseInt(e.status,10)||3===parseInt(e.status,10))),c=null===ve||void 0===ve||null===(i=ve.task_by_active_user)||void 0===i?void 0:i.filter((e=>2===parseInt(e.status,10)));he({todo:null===n||void 0===n?void 0:n.length,inprogress:null===a||void 0===a?void 0:a.length,underReview:null===c||void 0===c?void 0:c.length,done:null===d||void 0===d?void 0:d.length}),$(null===ve||void 0===ve||null===(l=ve.current_stage)||void 0===l?void 0:l.phase_id),"business"===(null===ve||void 0===ve?void 0:ve.category)?ie(!0):ie(!1),async function(){await xe.post("api/project/progress/collection",{ids:[O]}).then((e=>{var s;re(null===(s=e.data.data[0])||void 0===s?void 0:s.progress)})).catch((e=>console.log(e)))}()}),[ve]);const ge=async()=>{await xe.get("api/project/".concat(O,"/history")).then((e=>Y(e.data.data))).catch((e=>console.log(e)))};(0,i.useEffect)((()=>{ge()}),[O]),(0,i.useEffect)((()=>{!async function(){await xe.get("api/employe/assignment-list").then((e=>K(e.data.data))).catch((e=>console.log(e)))}()}),[]);const fe=["Manager","Director"];return(0,i.useEffect)((()=>{!async function(){await xe.get("api/project/partner/options").then((e=>ne(e.data.data))).catch((e=>console.log(e)))}()}),[]),(0,i.useEffect)((()=>{pe()}),[O]),(0,R.jsx)(R.Fragment,{children:me?(0,R.jsx)(l.A,{lg:"12",children:(0,R.jsx)(n.A,{children:(0,R.jsx)(a.A,{children:"Loading..."})})}):je?"Soemthing went wrong.":(0,R.jsxs)(d.A,{children:[(0,R.jsxs)(l.A,{lg:"8",children:[(0,R.jsx)(n.A,{className:"rounded-3 mb-3",children:(0,R.jsxs)(a.A,{children:[(0,R.jsx)("div",{children:(0,R.jsx)(c.A,{tag:"h5",className:"text-dark fw-bold",children:"Description"})}),(0,R.jsx)("div",{className:"ms-auto mt-3 mt-md-0",children:te?null===(e=ve.current_stage)||void 0===e?void 0:e.desc:null===ve||void 0===ve?void 0:ve.goals}),(0,R.jsxs)("div",{className:"d-flex justify-content-between mt-3",children:[(0,R.jsxs)("div",{className:"d-flex flex-column",children:[(0,R.jsx)("small",{className:"text-muted",children:"Level"}),(0,R.jsx)("span",{className:"text-dark",children:ve.level_desc})]}),(0,R.jsxs)("div",{className:"d-flex flex-column col-4",children:[(0,R.jsx)("small",{className:"text-muted",children:"Base"}),(0,R.jsxs)("div",{className:"d-flex",children:[(0,R.jsx)("span",{className:"wtext-dark",children:(null===ve||void 0===ve?void 0:ve.base_description.trim().length)>25?"".concat(null===ve||void 0===ve?void 0:ve.base_description.substring(0,25),"..."):null===ve||void 0===ve?void 0:ve.base_description}),(0,R.jsx)("abbr",{title:null===ve||void 0===ve?void 0:ve.base_description,children:(0,R.jsx)("i",{className:"me-2 bi-info-circle-fill",style:{fontSize:"14px",marginLeft:"4px"}})})]})]}),(0,R.jsxs)("div",{className:"d-flex flex-column",children:[(0,R.jsx)("small",{className:"text-muted",children:"Start date"}),(0,R.jsx)("span",{className:"text-dark",children:(0,E.A)((null===ve||void 0===ve?void 0:ve.current_stage)&&(null===(s=ve.current_stage)||void 0===s?void 0:s.start_date))})]}),(0,R.jsxs)("div",{className:"d-flex flex-column",children:[(0,R.jsx)("small",{className:"text-muted",children:"Deadline"}),(0,R.jsx)("span",{className:"text-dark",children:(0,E.A)(null!==(null===ve||void 0===ve?void 0:ve.current_stage)&&(null===(t=ve.current_stage)||void 0===t?void 0:t.end_date))})]})]}),(0,R.jsxs)("div",{className:"d-flex justify-content-between bg-light align-items-end p-2 mt-3",style:{borderRadius:"8px"},children:[(0,R.jsxs)("div",{className:"d-flex gap-3 align-items-center",children:[(0,R.jsx)("img",{src:w,className:"rounded-circle",alt:"avatar",width:"45",height:"45"}),(0,R.jsxs)("div",{className:"d-flex flex-column",children:[(0,R.jsx)("small",{className:"text-muted",children:"PIC"}),(0,R.jsx)("span",{className:"text-dark fw-bold",children:ve.pic_active.first_name})]})]}),(0,R.jsxs)("div",{className:"d-flex gap-3",children:[(0,R.jsxs)("span",{className:"badge text-info bg-light-info rounded-pill d-inline-block",children:["Est. Cost ",(0,R.jsx)("span",{className:"fw-bold",children:(0,D.A)(ve.estimated_cost)})]}),(0,R.jsxs)("span",{className:"badge text-info bg-light-info rounded-pill d-inline-block",children:["Est. Income ",(0,R.jsx)("span",{className:"fw-bold",children:(0,D.A)(ve.estimated_income)})]})]})]})]})}),(0,R.jsx)(n.A,{className:"rounded-3",children:(0,R.jsxs)(a.A,{children:[(0,R.jsx)("div",{children:(0,R.jsx)(c.A,{tag:"h5",className:"text-dark fw-bold",children:"Project Histories"})}),(0,R.jsx)("div",{className:"d-flex flex-column gap-2",children:B?null===B||void 0===B?void 0:B.map((e=>{var s;return(0,R.jsxs)("div",{className:"col-md-12 d-flex justify-content-between align-items-center py-2 px-3",style:{backgroundColor:"#F3F2F2",borderRadius:"8px"},children:[(0,R.jsxs)("div",{className:"col-md-4 d-flex flex-column",children:[(0,R.jsx)("span",{className:"text-dark",children:e.organization_name}),(0,R.jsx)("small",{children:e.history_desc}),(null===P||void 0===P||null===(s=P.user)||void 0===s?void 0:s.roles.find((e=>fe.includes(e))))&&(0,R.jsx)(_.N_,{to:"/projects/details/".concat(O,"?div=").concat(e.organization_id,"&to=activities"),style:{textDecoration:"none"},children:"See all task"})]}),(0,R.jsx)("div",{className:"col-md-2",children:(0,R.jsx)("span",{className:"badge bg-light-".concat("handover"===e.status&&0===e.active?"danger text-danger":"handover"===e.status?"success text-success":"review"===e.status?"danger text-danger":"primary text-primary"," rounded-pill d-inline-block fw-bold"),children:"handover"===e.status&&0===e.active?"waiting for approval":"handover"===e.status&&1===e.active||1===e.active?"active":e.status})}),(0,R.jsx)("div",{className:"col-md-3 d-flex flex-column",children:(0,R.jsx)("small",{children:(0,C.A)(e.created_at)})}),(0,R.jsxs)("div",{className:"col-md-1 d-flex justify-content-end",children:[(0,R.jsx)("img",{id:"tooltip-".concat(e.history_id),src:e.img||w,className:"rounded-circle",alt:"avatar",width:"35",height:"35"}),(0,R.jsx)(F.A,{title:e.first_name,id:e.history_id.toString()})]})]},e.history_id)})):"Loading..."})]})})]}),(0,R.jsxs)(l.A,{lg:"4",children:[(0,R.jsx)(n.A,{className:"rounded-3 mb-3",children:(0,R.jsxs)(a.A,{children:[(0,R.jsxs)(c.A,{tag:"h5",className:"d-flex justify-content-between fw-bold",children:["Project Active",(0,R.jsxs)("span",{className:"text-success fw-bold",children:[ce.toFixed(),"%"]})]}),(0,R.jsx)(r.A,{className:"",color:"success",value:ce.toFixed(),style:{height:"15px"}})]})}),(0,R.jsx)(n.A,{className:"rounded-3",children:(0,R.jsxs)(a.A,{children:[(0,R.jsxs)("div",{className:"overall-process",children:[(0,R.jsxs)("div",{className:"overall-child",children:[(0,R.jsxs)("div",{children:[(0,R.jsx)("h6",{className:"text-muted",children:"Remaining days"}),(0,R.jsx)("span",{className:"text-danger",children:L(null!==(null===ve||void 0===ve?void 0:ve.current_stage)&&(null===(b=ve.current_stage)||void 0===b?void 0:b.end_date)).toFixed()})]}),(0,R.jsx)(A(),{icon:"timer"})]}),(0,R.jsxs)("div",{className:"overall-child",children:[(0,R.jsxs)("div",{children:[(0,R.jsx)("h6",{className:"text-muted",children:"Task Todo"}),(0,R.jsx)("span",{children:null===oe||void 0===oe?void 0:oe.todo})]}),(0,R.jsx)(A(),{icon:"schedule"})]})]}),(0,R.jsxs)("div",{className:"overall-process",children:[(0,R.jsxs)("div",{className:"overall-child",children:[(0,R.jsxs)("div",{children:[(0,R.jsx)("h6",{className:"text-muted",children:"Task In Progress"}),(0,R.jsx)("span",{children:null===oe||void 0===oe?void 0:oe.inprogress})]}),(0,R.jsx)(A(),{icon:"play_circle_outline"})]}),(0,R.jsxs)("div",{className:"overall-child",children:[(0,R.jsxs)("div",{children:[(0,R.jsx)("h6",{className:"text-muted",children:"Task Done"}),(0,R.jsx)("span",{children:null===oe||void 0===oe?void 0:oe.done})]}),(0,R.jsx)(A(),{icon:"task_alt"})]})]})]})}),te&&P.user.roles.includes("Manager")&&P.user.employe_id===(null===ve||void 0===ve||null===(S=ve.pic_active)||void 0===S?void 0:S.employe_id)&&(0,R.jsx)(n.A,{children:(0,R.jsx)(o.A,{type:"button",color:"info",disabled:100!==ce||0!==(null===oe||void 0===oe?void 0:oe.underReview)||0!==(null===oe||void 0===oe?void 0:oe.todo)||0!==(null===oe||void 0===oe?void 0:oe.inprogress),outline:!0,onClick:ue.bind(null),children:"Handover Project"})})]}),(0,R.jsxs)(h.A,{isOpen:V,toggle:ue.bind(null),size:"md",fade:!1,centered:!0,children:[(0,R.jsx)(x.A,{toggle:ue.bind(null),children:"Handover Project"}),(0,R.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),Z(!0),await xe.post("api/project/handover",{project_id:O,new_pic:W.value,file:G,schema:2===Q?ee:"",partner:2===Q?ae:""},{headers:{"Content-Type":"multipart/form-data"}}).then((()=>{ge(),(0,I.x)("success","BAST is under review")})).catch((e=>console.log(e))),Z(!1),q(!1)},children:[(0,R.jsxs)(u.A,{children:[(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{children:"Option"}),(0,R.jsxs)(v.A,{type:"select",id:"base_id",name:"base_id",defaultValue:"a",children:[(0,R.jsx)("option",{value:"a",disabled:!0,children:"Select"}),(0,R.jsx)("option",{value:"",children:"Hand Over"}),(0,R.jsx)("option",{value:"",children:"Done"})]})]}),2===Q&&(0,R.jsxs)(R.Fragment,{children:[null===(null===ve||void 0===ve||null===(M=ve.current_stage)||void 0===M?void 0:M.partner)&&(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{for:"partner",children:"Partner"}),(0,R.jsxs)(v.A,{type:"select",id:"partner",name:"partner",defaultValue:"pa",onChange:e=>de(e.target.value),children:[(0,R.jsx)("option",{disabled:!0,value:"pa",children:"- Select -"}),le.length>0&&le.map((e=>(0,R.jsx)("option",{value:e.id,children:e.name},e.id)))]})]}),(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{children:"Schema"}),(0,R.jsxs)(v.A,{type:"select",id:"base_id",name:"base_id",defaultValue:"a",onChange:e=>se(e.target.value),children:[(0,R.jsx)("option",{value:"a",disabled:!0,children:"Select"}),(0,R.jsx)("option",{value:"jo",children:"JO"}),(0,R.jsx)("option",{value:"jv",children:"JV"})]})]})]}),(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{children:"PIC"}),(0,R.jsx)(N.Ay,{components:T,options:H,onChange:e=>J(e)})]}),(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{htmlFor:"bst",children:"BAST"}),(0,R.jsx)(m.A,{children:(0,R.jsx)(v.A,{type:"file",name:"file",id:"bst",onChange:e=>X(e.target.files)})})]})]}),(0,R.jsxs)(p.A,{children:[(0,R.jsx)(o.A,{color:"secondary",outline:!0,onClick:ue.bind(null),children:"Cancel"}),(0,R.jsx)(o.A,{type:"submit",color:"info",disabled:U,className:"d-flex gap-1 align-items-center",children:U?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(g.A,{className:"me-2",size:"sm",color:"light"}),"Sending"]}):(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(A(),{icon:"send",style:{fontSize:"20px"}}),"Send"]})})]})]})]})]})})};var P=t(89379),O=t(89804),B=t(24807);const Y=e=>{const{auth:s}=(0,z.A)(),{projectId:t,setNewTaskOpen:l,setAddSubtaskOpen:n,refetch:a,type:d,taskId:c,title:r,name:m}=e,[j,p]=(0,i.useState)(!1),[f,b]=(0,i.useState)({}),[_,w]=(0,i.useState)(!1),[C,E]=(0,i.useState)([]),[D,T]=(0,i.useState)(),L=(0,S.Ay)(),M=(0,y.Zp)(),O=()=>{w(!_)},B=(0,k.A)();(0,i.useEffect)((()=>{!async function(){await B.get("api/employe/assignment-list?search=".concat(m)).then((e=>{T(e.data.data)})).catch((e=>console.log(e)))}(),E([{value:s.user.employe_id,label:s.user.first_name}])}),[]);const Y=e=>{b((s=>(0,P.A)((0,P.A)({},s),{},{[e.target.name]:e.target.value})))},V=()=>{1===d?l(!1):n(void 0)};return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("div",{className:"task-form-overlay",onClick:V}),(0,R.jsx)("form",{onSubmit:async e=>{e.preventDefault(),p(!0),(null===C||void 0===C?void 0:C.length)>0?(f.project_id=t,f.task_pic=C,2===d&&(f.task_parent=c),await B.post("api/task",f,{headers:{"Content-Type":"multipart/form-data"}}).then((()=>{if(null!==s&&void 0!==s&&s.user.roles.includes("Manager")){const e=[];C.map((s=>e.push(s.value))),e.includes(null===s||void 0===s?void 0:s.user.employe_id)||M("?to=activities")}else M("");(0,I.x)("create","New task has been created.")})).catch((()=>(0,I.x)("error","New task failed to save"))),a(),V()):(0,I.x)("error","Assignment cannot be empty"),p(!1)},style:{width:"100%"},encType:"multipart/form-data",children:(0,R.jsxs)("div",{className:"new-task rounded-3",children:[(0,R.jsx)("div",{className:"body",children:(0,R.jsx)("div",{className:"input",children:(0,R.jsx)(v.A,{type:"textarea",name:"task_title",placeholder:"".concat(r,"..."),required:!0,onChange:Y,rows:"4",value:(null===f||void 0===f?void 0:f.task_title)||"",style:{fontSize:"13px"}})})}),(0,R.jsxs)("div",{className:"d-flex gap-3 justify-content-between",children:[(0,R.jsxs)("div",{className:"d-flex gap-0 w-75",children:[(0,R.jsxs)("div",{className:"d-flex align-items-center w-50",children:[(0,R.jsxs)("span",{className:"datepicker-toggle",children:[(0,R.jsx)("span",{className:"datepicker-toggle-button",children:(0,R.jsx)(A(),{icon:"calendar_month"})}),(0,R.jsx)("input",{type:"date",name:"start_date",className:"datepicker-input",required:!0,onChange:Y})]}),(0,R.jsxs)("div",{className:"d-flex flex-column",children:[(0,R.jsx)("small",{className:"text-muted",style:{fontSize:"12px"},children:"Start date"}),(0,R.jsx)("small",{className:"text-dark",style:{marginTop:"-7px"},children:f.start_date})]})]}),(0,R.jsxs)("div",{className:"d-flex align-items-center w-50",children:[(0,R.jsxs)("span",{className:"datepicker-toggle",children:[(0,R.jsx)("span",{className:"datepicker-toggle-button",children:(0,R.jsx)(A(),{icon:"calendar_month"})}),(0,R.jsx)("input",{type:"date",id:"end_date",name:"end_date",className:"datepicker-input",required:!0,onChange:Y})]}),(0,R.jsxs)("div",{className:"d-flex flex-column",children:[(0,R.jsx)("small",{htmlFor:"end_date",className:"text-muted",style:{fontSize:"12px"},children:"Due date"}),(0,R.jsx)("small",{className:"text-dark",style:{marginTop:"-7px"},children:f.end_date})]})]})]}),(0,R.jsxs)("div",{children:[(0,R.jsxs)("button",{type:"button",className:"btn-assigne",id:"tooltip-2",onClick:()=>{w(!0)},children:[(0,R.jsx)("i",{className:"bi-person-plus-fill"}),(0,R.jsx)("span",{children:(null===C||void 0===C?void 0:C.length)||0})]}),(0,R.jsx)(F.A,{title:"Assigne",id:"2"})]})]}),(0,R.jsxs)("div",{className:"footer mt-2",children:[(0,R.jsx)("div",{className:"option"}),(0,R.jsxs)("div",{className:"action",children:[(0,R.jsx)(o.A,{type:"button",size:"sm",color:"light",disabled:j,onClick:V,children:"Cancel"}),(0,R.jsx)(o.A,{type:"submit",size:"sm",className:"d-flex gap-2 align-items-center",disabled:j,children:j?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(g.A,{size:"sm"}),"Loading..."]}):"Save"})]})]})]})}),(0,R.jsxs)(h.A,{isOpen:_,toggle:O.bind(null),size:"md",fade:!1,centered:!0,children:[(0,R.jsx)(x.A,{toggle:O.bind(null),children:"Assign to"}),(0,R.jsx)(u.A,{children:(0,R.jsx)(N.Ay,{components:L,isMulti:!0,defaultValue:C,options:D,onChange:e=>E(e)})})]})]})};var V=t(45916),q=t(80544),W=t(24063);const J=e=>{var s;let{itemValue:t,setIsAddingItem:l,setShowAddSub:n,selectedActivityId:a,setSelectedActivityId:d,setItemValue:c,refetch:r}=e;const{auth:m}=(0,z.A)(),[j,v]=(0,i.useState)(!1),[p,g]=(0,i.useState)({}),[f,b]=(0,i.useState)(),A=(0,S.Ay)(),y=()=>{v(!j)},_=(0,k.A)();(0,i.useEffect)((()=>{!async function(){await _.get("api/employe/assignment-list?search=subordinate").then((e=>{b(e.data.data)})).catch((e=>console.log(e)))}(),g({value:null===m||void 0===m?void 0:m.user.employe_id,label:null===m||void 0===m?void 0:m.user.first_name})}),[]);const w=e=>{v(e)};return(0,R.jsxs)("div",{className:"form-wrap",children:[(0,R.jsx)("div",{className:"form-input",children:(0,R.jsx)("input",{type:"text",placeholder:"Add Sub Activity...",onChange:e=>c(e.target.value),autoFocus:!0})}),(0,R.jsxs)("div",{className:"form-assigne",children:[(0,R.jsxs)("div",{className:"assigne",children:[(0,R.jsx)("button",{type:"button",className:"btn-assigne",id:"tooltip-2",onClick:()=>w(!0),children:(0,R.jsx)("i",{className:"".concat(null!==m&&void 0!==m&&null!==(s=m.user)&&void 0!==s&&s.roles.includes("Staff")?"bi-person-fill":"bi-person-plus-fill")})}),(0,R.jsx)("span",{children:p.label})]}),(0,R.jsxs)("div",{className:"action",children:[(0,R.jsx)(o.A,{className:"btn-cancel",type:"button",size:"sm",color:"light",onClick:()=>{n(!1),d(void 0)},children:"Cancel"}),(0,R.jsx)(o.A,{type:"button",onClick:()=>(async()=>{var e;if(""===t)(0,I.x)("error","Field cannot be empty");else if(0===(null===(e=Object.keys(p))||void 0===e?void 0:e.length))(0,I.x)("error","Please select an employee");else{l(!0);const e={sub:[{sub:t,status:"created",employe_id:null===p||void 0===p?void 0:p.value}]};await _.patch("api/task/".concat(a,"/activity/add-sub"),e).then((()=>{r()})).catch((()=>(0,I.x)("error","Action failed"))),d(),n(!1),l(!1),c({}),g({})}})(),children:"Save"})]}),(0,R.jsxs)(h.A,{isOpen:j,toggle:y.bind(null),size:"md",fade:!1,centered:!0,children:[(0,R.jsx)(x.A,{toggle:y.bind(null),children:"Assign to"}),(0,R.jsx)(u.A,{children:(0,R.jsx)(N.Ay,{components:A,defaultValue:p,options:f,onChange:e=>{g(e),w(!1)}})})]})]})]})},H=["Manager"],K=["Supervisor","Manager"],U=["Staff","Supervisor","Manager"],Z=e=>{var s,t;let{directSupervisor:l,data:n,projectId:a,refetch:d,isMemberActive:c}=e;const{auth:r}=(0,z.A)(),[o,h]=(0,i.useState)(!1),[x,u]=(0,i.useState)(void 0),[m,j]=(0,i.useState)(void 0),[v,p]=(0,i.useState)(),[f,b]=(0,i.useState)(),[y,_]=(0,i.useState)(),[N,S]=(0,i.useState)(void 0),[C,D]=(0,i.useState)(!1),[T,L]=(0,i.useState)(""),[M,Z]=(0,i.useState)(!1),[G,X]=(0,i.useState)(),[Q,$]=(0,i.useState)(),[ee,se]=(0,i.useState)(!1),[te,ie]=(0,i.useState)(!1),[le,ne]=(0,i.useState)(null),[ae,de]=(0,i.useState)(!1),[ce,re]=(0,i.useState)(""),oe=(0,k.A)(),he=null===r||void 0===r||null===(s=r.user)||void 0===s?void 0:s.roles,xe=null===r||void 0===r||null===(t=r.user)||void 0===t?void 0:t.employe_id,ue=e=>{h(!0),j(e)},me=async(e,s)=>{b(e),_(s),p(!0),await oe.put("api/task/".concat(e,"/status"),{employe_id:r.user.employe_id,status:s}).then((()=>{(0,I.x)(1===s?"start":2===s?"done":"success","Task status has been changed to ".concat(0===s?"To Do":1===s?"In Progress":"Done"))})).catch((e=>{(0,I.x)("error",e.response.data.error)})),d(),p(!1),b(),_()},je=e=>{de(!0),setTimeout((()=>{de(!1)}),5e3),console.log(e)},ve={options:[{id:1,icon:(0,R.jsx)(A(),{icon:"edit_note"}),type:"button",label:"To do",to:0},{id:2,icon:(0,R.jsx)(A(),{icon:"play_circle_outline"}),type:"button",label:"In Progress",to:1},{id:3,icon:(0,R.jsx)(A(),{icon:"task_alt"}),type:"button",label:"Done",to:2},{id:4,icon:(0,R.jsx)(A(),{icon:"content_copy"}),type:"link",label:"Duplicate",to:"duplicate"}]},pe=new URLSearchParams(window.location.search),ge=pe.get("task");return(0,i.useEffect)((()=>{ne(ge)}),[pe]),(0,i.useEffect)((()=>{if(null!==le){const e=document.getElementById(le);null!==e&&e.scrollIntoView()}}),[le]),(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("div",{className:"",children:null===n||void 0===n?void 0:n.map(((e,s)=>{var t,n,r;return(0,R.jsxs)("div",{className:"board rounded-3",children:[(0,R.jsxs)("div",{className:"board-header",children:[(0,R.jsxs)("div",{className:"d-flex gap-2",style:{height:"max-content"},children:[(0,R.jsxs)(O.A,{color:"info",className:"bg-light-".concat(0===e.status?"primary":1===e.status?"warning":"success"," text-").concat(0===e.status?"primary":1===e.status?"warning":"success"," fw-bold"),children:["#",s+1]}),4===parseInt(e.status,10)&&(0,R.jsxs)(O.A,{color:"danger",children:[(0,R.jsx)("i",{className:"bi-pencil-square mr-4",style:{fontSize:"12px"}}),"\xa0 Revision"]})]}),0===parseInt(e.status,10)||1===parseInt(e.status,10)||4===parseInt(e.status,10)?v&&f===e.task_id?(0,R.jsxs)("div",{className:"d-flex align-items-center gap-1",children:[(0,R.jsx)(g.A,{size:"sm",color:"success"}),(0,R.jsxs)("span",{style:{fontSize:"12px"},children:["Updating status to"," ",(0,R.jsx)("strong",{children:0===y?"To do":1===y?"In Progress":2===y?"Done":""})]})]}):ae?(0,R.jsxs)("div",{className:"d-flex align-items-center gap-1",children:[(0,R.jsx)(g.A,{size:"sm",color:"success"}),(0,R.jsx)("span",{style:{fontSize:"12px"},children:"Duplicating the task.."})]}):(0,R.jsxs)("div",{className:"d-flex gap-2",children:[(0,R.jsx)("div",{className:"",children:1===parseInt(e.status,10)&&(0,R.jsxs)("span",{style:{fontSize:"12px"},children:["Progress","  ",(0,R.jsxs)("strong",{style:{fontSize:"14px",color:100===e.task_progress?"#4cc790":"#21C1D6"},children:[e.task_progress.toFixed(),"%"]})]})}),(0,R.jsx)("div",{children:c&&(0,R.jsx)(V.A,{menuOptions:ve,taskId:e.task_id,status:parseInt(e.status,10),action:me,progress:e.task_progress,duplicateFn:je})},e.task_id)]}):2===parseInt(e.status,10)?(0,R.jsxs)(O.A,{color:"light",className:"d-flex text-dark",children:[(0,R.jsx)("i",{className:"bi-clock mr-4",style:{fontSize:"12px"}}),"\xa0 Waiting for approval"]}):3===parseInt(e.status,10)?(0,R.jsxs)(O.A,{color:"success",className:"d-flex",children:[(0,R.jsx)("i",{className:"bi-check2-circle mr-4",style:{fontSize:"13px"}}),"\xa0 Approved"]}):""]}),(0,R.jsxs)("div",{className:"board-body task ".concat(ge===e.task_id.toString()&&"bg-light-warning"),children:[(0,R.jsx)("div",{className:"task-title fw-bold",onClick:()=>ue(e),id:e.task_id.toString()===le?le:"",children:e.task_title}),(0,R.jsxs)("div",{className:"task-bottom",children:[(0,R.jsx)("div",{className:"task-info",children:he.find((e=>null===H||void 0===H?void 0:H.includes(e)))&&2!==parseInt(e.status,10)&&3!==parseInt(e.status,10)&&(0,R.jsx)("button",{type:"button",className:"add-child",onClick:()=>u(e.task_id),children:(0,R.jsx)(A(),{icon:"add_circle"})})}),(0,R.jsx)("div",{className:"task-action",children:(0,R.jsxs)("div",{className:"comment",children:[(0,R.jsx)(A(),{icon:"comment"}),(0,R.jsx)("div",{children:e.comments})]})})]}),x===e.task_id&&(0,R.jsx)("div",{className:"p-1",children:(0,R.jsx)(Y,{projectId:a,setAddSubtaskOpen:u,refetch:d,type:2,title:"Add new target..",taskId:e.task_id})})]}),(null===(t=e.level_2)||void 0===t?void 0:t.length)>0&&e.level_2.map((s=>{var t;return(0,R.jsxs)("div",{className:"board-container",children:[(0,R.jsxs)("div",{className:"board-body subtask ".concat(ge===s.task_id.toString()&&"bg-light-warning"),children:[(0,R.jsx)("div",{className:"task-title",onClick:()=>ue(s),id:s.task_id.toString()===le?le:"",children:s.task_title}),(0,R.jsxs)("div",{className:"task-bottom",children:[(0,R.jsx)("div",{className:"task-info",children:he.find((e=>null===K||void 0===K?void 0:K.includes(e)))&&2!==parseInt(e.status,10)&&3!==parseInt(e.status,10)&&(0,R.jsx)("button",{type:"button",className:"add-child",onClick:()=>u(s.task_id),children:(0,R.jsx)(A(),{icon:"add_circle"})})}),(0,R.jsxs)("div",{className:"task-action",children:[(0,R.jsx)("div",{className:"circular-progress",children:(0,R.jsx)(q.A,{data:parseInt(s.task_progress.toFixed(),10)})}),(0,R.jsxs)("div",{className:"comment",children:[(0,R.jsx)(A(),{icon:"comment"}),(0,R.jsx)("div",{children:s.comments})]})]})]}),x===s.task_id&&(0,R.jsx)("div",{className:"p-1",children:(0,R.jsx)(Y,{projectId:a,setAddSubtaskOpen:u,refetch:d,type:2,title:"Add new activity..",taskId:s.task_id,name:"activity"})})]},s.task_id),(null===(t=s.level_3)||void 0===t?void 0:t.length)>0&&s.level_3.map((s=>{var t;return(0,R.jsxs)("div",{className:"board-body subtask-level3 ".concat(ge===s.task_id.toString()&&"bg-light-warning"),children:[(0,R.jsx)("div",{className:"task-title",onClick:()=>{ue(s),re("activity")},children:s.task_title}),(0,R.jsxs)("div",{className:"task-bottom",children:[(0,R.jsxs)("div",{className:"task-info",children:[(0,R.jsxs)("span",{className:"text-muted",children:[null!==s.sub?JSON.parse(s.sub).length:0," Sub"]}),he.find((e=>null===U||void 0===U?void 0:U.includes(e)))&&s.task_id!==N&&2!==parseInt(e.status,10)&&3!==parseInt(e.status,10)&&(0,R.jsx)("button",{type:"button",className:"add-child",onClick:()=>(e=>{if(null!==he&&void 0!==he&&he.includes("Staff")){const s=[];for(let t=0;t<(null===e||void 0===e?void 0:e.pics.length);t++)s.push(e.pics[t].employe_id.toString());s.includes(l)||s.includes(xe)?(D(!0),S(e.task_id)):(0,I.x)("error","You are not allowed")}else D(!0),S(e.task_id)})(s),children:(0,R.jsx)(A(),{icon:"add"})})]}),(0,R.jsxs)("div",{className:"task-action",children:[(0,R.jsx)("div",{className:"circular-progress",children:(0,R.jsx)(q.A,{data:parseInt(s.task_progress.toFixed(),10)})}),(0,R.jsxs)("div",{className:"comment",children:[(0,R.jsx)(A(),{icon:"comment"}),(0,R.jsx)("div",{children:s.comments})]})]})]}),C&&(0,R.jsx)("div",{className:"add-item",children:M&&N===s.task_id?(0,R.jsxs)("div",{className:"saving",children:[(0,R.jsx)(g.A,{size:"sm",color:"success"}),(0,R.jsx)("span",{children:"Saving.."})]}):N===s.task_id&&(0,R.jsx)(J,{itemValue:T,setIsAddingItem:Z,setShowAddSub:D,selectedActivityId:N,setSelectedActivityId:S,setItemValue:L,refetch:d})}),null!==s.sub&&(0,R.jsx)("div",{className:"sub-list",children:null===(t=JSON.parse(s.sub))||void 0===t?void 0:t.map((e=>(0,R.jsxs)("div",{className:"sub-item",children:[(0,R.jsx)("button",{type:"button",onClick:()=>(async(e,s)=>{se(!0),X(s.task_id),$(e);const t=JSON.parse(s.sub).map((s=>s.id===e?(0,P.A)((0,P.A)({},s),{},{status:"created"===s.status?"checked":"created"}):s));await oe.patch("api/task/".concat(s.task_id,"/activity/update-sub"),{sub:t}).then((()=>{d()})).catch((()=>(0,I.x)("error","Something went wrong"))),$(),se(!1)})(e.id,s),disabled:e.employe_id!==xe,children:(0,R.jsxs)("div",{className:"item-title ".concat(ee&&e.id===Q&&s.task_id===G&&"checking"),children:[(0,R.jsxs)("div",{className:"title-check ".concat(ee&&e.id!==Q&&"not-allowed"),children:[ee&&e.id===Q&&s.task_id===G&&(0,R.jsx)(g.A,{size:"sm",color:"primary"}),"checked"===e.status&&Q!==e.id&&(0,R.jsx)(A(),{icon:"done"})]}),(0,R.jsx)("div",{className:"title-text",children:(0,R.jsxs)("span",{children:["checked"===e.status?(0,R.jsx)("s",{children:e.sub}):e.sub," "]})})]})}),(0,R.jsx)("div",{className:"item-action",children:e.employe_id===xe&&(0,R.jsx)("button",{type:"button",className:"delete",onClick:()=>(async(e,s)=>{ie(!0),X(s.task_id),$(e);const t=JSON.parse(s.sub).filter((s=>s.id!==e));await oe.patch("api/task/".concat(s.task_id,"/activity/update-sub"),{sub:t}).then((()=>{d()})).catch((()=>(0,I.x)("error","Something went wrong"))),ie(!1)})(e.id,s),children:te&&e.id===Q&&s.task_id===G?(0,R.jsx)(g.A,{size:"sm",color:"danger"}):(0,R.jsx)(A(),{icon:"delete"})})})]},e.id)))})]},s.task_id)}))]},s.task_id)})),3!==parseInt(e.status,10)&&(0,R.jsx)("div",{className:"board-footer",children:(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)("div",{className:"d-flex gap-2",children:[(0,R.jsx)(A(),{icon:"event",style:{fontSize:"20px"}}),(0,R.jsx)("span",{className:"".concat((0,W.A)(e.end_date)?"text-danger":""," "),style:{fontSize:"12px"},children:(0,E.A)(e.end_date)})]}),(0,R.jsx)("div",{className:"members",children:(0,R.jsxs)("div",{className:"members-item",children:[null===e||void 0===e||null===(n=e.pics)||void 0===n?void 0:n.map(((e,s)=>s<2&&(0,R.jsxs)(i.Fragment,{children:[(0,R.jsx)("img",{id:"tooltip-".concat(e.id),src:w,className:"ava-pic rounded-circle",alt:"avatar",width:"35",height:"35"}),(0,R.jsx)(F.A,{title:e.first_name,id:e.id.toString()})]},e.id))),(null===e||void 0===e||null===(r=e.pics)||void 0===r?void 0:r.length)>2&&(0,R.jsxs)("div",{className:"member-plus bg-light-info text-info fw-bold",children:["+",e.pics.length-2]})]})})]})})]},e.task_id)}))}),o&&(0,R.jsx)(B.A,{modal:o,setModal:h,toggle:()=>{h(!o)},task:m,refetch:d,name:ce})]})},G=["Manager"],X=e=>{var s;let{directSupervisor:t,data:n,isLoading:a,error:d,refetch:c,isRefetching:r,isMemberActive:h}=e;const{auth:x}=(0,z.A)(),[u,m]=(0,i.useState)(!1),{projectId:j}=(0,y.g)();return(0,R.jsxs)(l.A,{lg:"4",className:"mt-1",children:[(0,R.jsxs)("div",{className:"d-flex align-items-center justify-content-between bg-light-primary text-primary py-1 px-2 mb-2 rounded-3",children:[(0,R.jsx)("span",{className:"fw-bold",children:"To do"}),(0,R.jsx)("span",{className:"fw-bold",children:null===n||void 0===n?void 0:n.length})]}),a?"Loading...":d?"Something went wrong.":(0,R.jsxs)(R.Fragment,{children:[h&&(null===x||void 0===x||null===(s=x.user)||void 0===s?void 0:s.roles.find((e=>null===G||void 0===G?void 0:G.includes(e))))&&(u?(0,R.jsx)(Y,{projectId:j,setNewTaskOpen:m,refetch:c,type:1,title:"Create new goal.."}):(0,R.jsxs)(o.A,{type:"button",size:"sm",color:"secondary",className:"d-flex align-items-center justify-content-center rounded-2",block:!0,onClick:()=>m(!0),children:[(0,R.jsx)(A(),{icon:"add",style:{fontSize:"14px"}}),"Add Goal"]})),(0,R.jsx)(Z,{directSupervisor:t,data:n,projectId:j,refetch:c,isRefetching:r,isMemberActive:h})]})]})},Q=e=>{let{directSupervisor:s,data:t,isLoading:i,error:n,refetch:a,isRefetching:d,isMemberActive:c}=e;const{projectId:r}=(0,y.g)();return(0,R.jsxs)(l.A,{lg:"4",className:"mt-1",children:[(0,R.jsxs)("div",{className:"d-flex align-items-center justify-content-between bg-light-warning text-warning py-1 px-2 mb-2 rounded-3",children:[(0,R.jsx)("span",{className:"fw-bold",children:"In progress"}),(0,R.jsx)("span",{className:"fw-bold",children:null===t||void 0===t?void 0:t.length})]}),i?"Loading...":n?"Something went wrong.":(0,R.jsx)(R.Fragment,{children:(0,R.jsx)(Z,{directSupervisor:s,data:t,projectId:r,refetch:a,isRefetching:d,isMemberActive:c})})]})},$=e=>{let{data:s,isLoading:t,error:i,refetch:n,isRefetching:a}=e;const{projectId:d}=(0,y.g)();return(0,R.jsxs)(l.A,{lg:"4",className:"mt-1",children:[(0,R.jsxs)("div",{className:"d-flex align-items-center justify-content-between bg-light-success text-success py-1 px-2 mb-2 rounded-3",children:[(0,R.jsx)("span",{className:"fw-bold",children:"Done"}),(0,R.jsx)("span",{className:"fw-bold",children:null===s||void 0===s?void 0:s.length})]}),t?"Loading...":i?"Something went wrong.":(0,R.jsx)(R.Fragment,{children:(0,R.jsx)(Z,{data:s,projectId:d,refetch:n,isRefetching:a})})]})},ee=e=>null===e||void 0===e?void 0:e.filter(((s,t)=>(null===e||void 0===e?void 0:e.findIndex((e=>e.task_id===s.task_id)))===t)),se=()=>{const{projectId:e}=(0,y.g)(),[s,t]=(0,i.useState)([]),[c,r]=(0,i.useState)([]),[o,h]=(0,i.useState)([]),[x,u]=(0,i.useState)(""),[m,j]=(0,i.useState)(!1),v=(0,k.A)(),{isLoading:p,error:g,data:b,refetch:A,isRefetching:_}=(0,f.I)({queryKey:["todos"],queryFn:()=>v.get("api/task/".concat(e,"/employe/list")).then((e=>(j(e.data.is_member_active),u(e.data.direct_supervisor.toString()),e.data.data)))});return(0,i.useEffect)((()=>{const e=null===b||void 0===b?void 0:b.filter((e=>0===parseInt(e.status,10)||4===parseInt(e.status,10))),s=null===b||void 0===b?void 0:b.filter((e=>1===parseInt(e.status,10))),i=null===b||void 0===b?void 0:b.filter((e=>2===parseInt(e.status,10)||3===parseInt(e.status,10)));t(e),r(ee(s)),h(ee(i))}),[b]),(0,i.useEffect)((()=>{A()}),[e]),(0,R.jsx)(d.A,{children:p?(0,R.jsx)(l.A,{children:(0,R.jsx)(n.A,{children:(0,R.jsx)(a.A,{className:"text-center",children:(0,R.jsx)("h6",{className:"tex-muted",children:"Loading..."})})})}):(0,R.jsx)(l.A,{children:(0,R.jsxs)(d.A,{children:[(0,R.jsx)(X,{data:s,directSupervisor:x,isLoading:p,error:g,refetch:A,isRefetching:_,isMemberActive:m}),(0,R.jsx)(Q,{data:c,directSupervisor:x,isLoading:p,error:g,refetch:A,isRefetching:_,isMemberActive:m}),(0,R.jsx)($,{data:o,isLoading:p,error:g,refetch:A,isRefetching:_})]})})})},te=e=>{let{children:s}=e;return(0,R.jsx)("table",{className:"rounded-corners",children:s})},ie=()=>{const[e,s]=(0,i.useState)(),t=(0,k.A)(),{projectId:d}=(0,y.g)(),{isLoading:c,error:r,data:o,refetch:h}=(0,f.I)({queryKey:["members"],queryFn:()=>t.get("api/project/".concat(d,"/members")).then((e=>(s(e.data.count_task),e.data.data)))});return(0,i.useEffect)((()=>{h()}),[d]),(0,R.jsx)(l.A,{children:(0,R.jsx)(n.A,{className:"rounded-3",children:(0,R.jsx)(a.A,{children:c?"Loading...":r?"Something went wrong.":(null===o||void 0===o?void 0:o.length)>0?(0,R.jsx)(te,{children:(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("thead",{children:(0,R.jsxs)("tr",{children:[(0,R.jsx)("th",{children:"#"}),(0,R.jsx)("th",{children:"Name"}),(0,R.jsx)("th",{children:"Position"}),(0,R.jsx)("th",{children:"Total Task"})]})}),(0,R.jsx)("tbody",{style:{overflow:"hidden"},children:null===o||void 0===o?void 0:o.map(((s,t)=>{return(0,R.jsxs)("tr",{children:[(0,R.jsx)("td",{children:t+1}),(0,R.jsx)("td",{children:s.first_name}),(0,R.jsx)("td",{children:s.position_name}),(0,R.jsx)("td",{children:e?(i=e,l=s.employe_id.toString(),i[l]):"-"})]},s.first_name);var i,l}))})]})}):(0,R.jsx)("div",{className:"d-flex justify-content-center",children:(0,R.jsx)("h6",{children:"No data yet."})})})})})};var le=t(3655);const ne=()=>{var e;const{projectId:s}=(0,y.g)(),t=(0,k.A)(),{isLoading:l,error:d,data:c,refetch:r}=(0,f.I)({queryKey:["files"],queryFn:()=>t.get("api/project/".concat(s,"/files")).then((e=>e.data.data))});return(0,i.useEffect)((()=>{r()}),[s]),(0,R.jsx)(n.A,{className:"rounded-3",children:(0,R.jsx)(a.A,{children:l?"Loading...":d?"Something went wrong.":(0,R.jsxs)(le.A,{className:"no-wrap align-middle",hover:!0,style:{zIndex:"-1",fontSize:"13px"},children:[(0,R.jsx)("thead",{children:(0,R.jsxs)("tr",{children:[(0,R.jsx)("th",{width:"60",children:"#"}),(0,R.jsx)("th",{width:"700",children:"Filename"}),(0,R.jsx)("th",{children:"User"}),(0,R.jsx)("th",{width:"200",children:"Uploaded at"})]})}),null!==c&&void 0!==c&&c.length?(0,R.jsx)("tbody",{style:{overflow:"hidden"},children:null===(o=c,e=o.sort(((e,s)=>{let{created_at:t}=e,{created_at:i}=s;return t<i?-1:t>i?1:0})))||void 0===e?void 0:e.reverse().map(((e,s)=>(0,R.jsxs)("tr",{children:[(0,R.jsx)("td",{children:s+1}),(0,R.jsx)("td",{children:(0,R.jsx)(_.N_,{to:"".concat("https://api.ptpema.co.id/","taskfiles/").concat(e.file_name),target:"blank",children:e.file_name})}),(0,R.jsx)("td",{children:e.employee||"-"}),(0,R.jsx)("td",{children:(0,C.A)(e.created_at)})]},e.file_id)))}):(0,R.jsx)("tbody",{style:{overflow:"hidden"},children:(0,R.jsx)("tr",{children:(0,R.jsx)("td",{colSpan:"4",className:"text-center",children:"No data yet."})})})]})})});var o};var ae=t(6221);const de=e=>{let{setTotalReview:s}=e;const{projectId:t}=(0,y.g)(),[d,r]=(0,i.useState)(!1),[j,b]=(0,i.useState)(""),[N,S]=(0,i.useState)(),[w,z]=(0,i.useState)(!1),[F,D]=(0,i.useState)(),[T,L]=(0,i.useState)(),M=(0,k.A)(),[P,B]=(0,i.useState)([]),{isLoading:Y,error:V,refetch:q,isRefetching:W}=(0,f.I)({queryKey:["review"],queryFn:()=>M.get("api/task/".concat(t,"/level1/review")).then((e=>(B(e.data.data),e.data.data)))}),J=()=>{r(!d)};(0,i.useEffect)((()=>{s(P.length)}),[P]),(0,i.useEffect)((()=>{q()}),[t]);const H=(e,s,t)=>{r(!0),b(e),S(s),L(t)};return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(l.A,{children:Y||W?(0,R.jsx)("div",{className:"d-flex justify-content-center",children:"Loading..."}):V?(0,R.jsxs)("div",{className:"d-flex justify-content-center",children:["Something went wrong ",(0,R.jsx)("span",{className:"material-icons",children:"sentiment_very_dissatisfied"})]}):P.map(((e,s)=>{var t,i;return(0,R.jsx)(n.A,{className:"custom-card rounded-3",children:(0,R.jsxs)(a.A,{children:[(0,R.jsxs)(c.A,{tag:"h4",className:"d-flex justify-content-between",children:[(0,R.jsxs)("div",{className:"d-flex gap-2",children:[(0,R.jsxs)(O.A,{color:"light",className:"text-dark",children:["#",s+1]}),(0,R.jsx)(O.A,{color:"info",className:"",children:e.first_name})]}),(0,R.jsx)("span",{style:{fontSize:"14px"},children:(0,C.A)(e.send_date)})]}),(0,R.jsx)("h5",{children:(0,R.jsx)("strong",{children:e.task_title})}),(0,R.jsx)("p",{children:e.task_desc}),(0,R.jsx)("span",{className:"text-dark",children:"Attachment:"}),(0,R.jsx)("div",{className:"",children:e.files.length>0?e.files.map(((e,s)=>(0,R.jsxs)("div",{className:"d-flex gap-3",children:[(0,R.jsxs)("span",{children:[s+1,"."]}),(0,R.jsx)(_.N_,{className:"file-link",to:"".concat("https://api.ptpema.co.id/","taskfiles/").concat(e.file_name),target:"blank",children:e.file_name})]},e.file_name))):"-"}),(0,R.jsxs)("div",{className:"d-flex justify-content-between align-items-center mt-4 border  py-2 px-3",style:{borderRadius:"10px"},children:[(0,R.jsxs)("div",{className:"d-flex gap-4",children:[(0,R.jsxs)("div",{color:"muted",children:[(0,R.jsx)("span",{className:"text-dark",children:"Start at: "}),(0,R.jsx)("br",{})," ",null===(t=(0,E.A)(e.start_date))||void 0===t?void 0:t.split(",")[0]]}),(0,R.jsxs)("div",{color:"muted",children:[(0,R.jsx)("span",{className:"text-dark",children:"Due at: "}),(0,R.jsx)("br",{})," ",null===(i=(0,E.A)(e.end_date))||void 0===i?void 0:i.split(",")[0]]})]}),(0,R.jsxs)("div",{className:"d-flex gap-2",children:[(0,R.jsx)(o.A,{type:"button",size:"sm",color:"warning",outline:!0,onClick:()=>H("revision",e.task_id,e.employe_id),children:"Revision"}),(0,R.jsx)(o.A,{type:"button",size:"sm",color:"success",onClick:()=>H("approve",e.task_id,e.employe_id),children:"Approve"})]})]})]})},e.approval_id)}))}),(0,R.jsxs)(h.A,{isOpen:d,toggle:J.bind(null),size:"md",fade:!1,centered:!0,children:[(0,R.jsx)(x.A,{toggle:J.bind(null),children:"approve"===j?"Approval":"Revision"}),(0,R.jsxs)(ae.A,{onSubmit:async e=>{e.preventDefault(),z(!0),await M.put("api/task/".concat(N,"/status"),{employe_id:T,status:"approve"===j?3:4,note:F}).then((()=>{(0,I.x)("success","Task has been ".concat("approve"===j?"approved":"reviewed"))})).catch((e=>console.log(e))),q(),r(!1),z(!1)},children:[(0,R.jsx)(u.A,{children:(0,R.jsx)(m.A,{children:(0,R.jsx)(v.A,{type:"textarea",id:"goals",name:"goals",placeholder:"Comment here..",rows:"3",required:!0,onChange:e=>D(e.target.value)})})}),(0,R.jsxs)(p.A,{children:[(0,R.jsx)(o.A,{color:"secondary",outline:!0,onClick:J.bind(null),children:"Cancel"}),(0,R.jsx)(o.A,{type:"submit",color:"".concat("approve"===j?"success":"warning"),disabled:w,className:"d-flex gap-1 align-items-center",children:w?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(g.A,{className:"me-2",size:"sm"}),"Sending..."]}):(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(A(),{icon:"send",style:{fontSize:"20px"}}),"approve"===j?"Approve":"Send"]})})]})]})]})]})},ce=()=>{var e,s;const[t,r]=(0,i.useState)(!1),[b,A]=(0,i.useState)(!1),[N,S]=(0,i.useState)({}),{auth:F}=(0,z.A)(),{projectId:E}=(0,y.g)(),D=(0,k.A)(),T=()=>{r(!t)},{isLoading:L,error:M,data:B,refetch:Y,isRefetching:V}=(0,f.I)({queryKey:["handover"],queryFn:()=>D.get("api/project/".concat(null===F||void 0===F?void 0:F.user.employe_id,"/").concat(E,"/handover")).then((e=>e.data.data))}),q=e=>{S((s=>(0,P.A)((0,P.A)({},s),{},{[e.target.name]:e.target.value})))};return(0,i.useEffect)((()=>{Y()}),[E]),(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(l.A,{children:L||V?(0,R.jsx)("div",{className:"d-flex justify-content-center",children:"Loading..."}):M?(0,R.jsxs)("div",{className:"d-flex justify-content-center",children:["Something went wrong ",(0,R.jsx)("span",{className:"material-icons",children:"sentiment_very_dissatisfied"})]}):null!==B&&(0,R.jsx)(n.A,{className:"custom-card",children:(0,R.jsxs)(a.A,{children:[(0,R.jsxs)(c.A,{tag:"h4",className:"d-flex justify-content-between",children:[(0,R.jsx)("div",{className:"d-flex gap-2",children:(0,R.jsx)(O.A,{color:"light",className:"text-dark",children:"Handover project"})}),(0,R.jsx)("span",{style:{fontSize:"14px"},children:(0,C.A)(B.created_at)})]}),(0,R.jsx)("div",{className:"d-flex  justify-content-center",children:(0,R.jsxs)("h5",{children:["Handover of the project from ",(0,R.jsx)("strong",{children:B.from_division})," to"," ",(0,R.jsx)("strong",{children:B.to_division})]})}),(0,R.jsx)("p",{}),(0,R.jsx)("span",{className:"text-dark",children:"BAST File:"}),(0,R.jsx)("div",{className:"",children:(0,R.jsx)("div",{className:"d-flex gap-3",children:(0,R.jsx)(_.N_,{className:"file-link",to:"".concat("https://api.ptpema.co.id/","project/").concat(B.file),target:"blank",children:B.file})})}),(0,R.jsxs)("div",{className:"d-flex justify-content-between align-items-center mt-4 border  py-2 px-3",style:{borderRadius:"10px"},children:[(0,R.jsx)("div",{className:"d-flex gap-4",children:(0,R.jsxs)("div",{className:"d-flex gap-3 align-items-center",children:[(0,R.jsx)("img",{src:w,className:"rounded-circle",alt:"avatar",width:"45",height:"45"}),(0,R.jsxs)("div",{className:"d-flex flex-column",children:[(0,R.jsx)("span",{className:"text-dark fw-bold",children:B.old_pic}),(0,R.jsx)("small",{className:"text-muted",children:B.from_division})]})]})}),(0,R.jsx)("div",{className:"d-flex gap-2",children:(0,R.jsx)(o.A,{type:"button",size:"md",color:"success",outline:!0,onClick:T.bind(null),children:"Confirm"})})]})]})})}),(0,R.jsxs)(h.A,{isOpen:t,toggle:T.bind(null),size:"md",fade:!1,centered:!0,children:[(0,R.jsx)(x.A,{toggle:T.bind(null),children:"Confirmation"}),(0,R.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),A(!0),D.post("api/project/".concat(null===B||void 0===B?void 0:B.history_id,"/confirm"),N).then((e=>{Y(),(0,I.x)("success",e.data.message)})).catch((e=>{(0,I.x)("error",e.response.data.error)})),r(!1),A(!1)},children:[(0,R.jsxs)(u.A,{children:[(0,R.jsx)("div",{className:"d-flex justify-content-center",children:(0,R.jsxs)("h6",{className:"fw-bold",children:["Next stage:"," ",1===(null===B||void 0===B||null===(e=B.current_stage)||void 0===e?void 0:e.phase)?"Planning":2===(null===B||void 0===B||null===(s=B.current_stage)||void 0===s?void 0:s.phase)?"Execution, Control & Monitoring":""]})}),(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{htmlFor:"desc_stage",children:"Description"}),(0,R.jsx)(v.A,{type:"textarea",name:"desc_stage",id:"desc_stage",placeholder:"stage description here..",rows:"3",onChange:q})]}),(0,R.jsxs)(d.A,{children:[(0,R.jsx)(l.A,{md:"6",children:(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{for:"start_date",children:"Start date"}),(0,R.jsx)(v.A,{type:"date",id:"start_date",name:"start_date",onChange:q})]})}),(0,R.jsx)(l.A,{md:"6",children:(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{for:"end_date",children:"End date"}),(0,R.jsx)(v.A,{type:"date",id:"end_date",name:"end_date",onChange:q})]})})]})]}),(0,R.jsxs)(p.A,{children:[(0,R.jsx)(o.A,{color:"secondary",outline:!0,onClick:T.bind(null),children:"Cancel"}),(0,R.jsx)(o.A,{type:"submit",color:"success",disabled:b,className:"d-flex gap-1 align-items-center",children:b?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(g.A,{className:"me-2",size:"sm",color:"light"}),"Sending"]}):"Send"})]})]})]})]})};var re=t(96316),oe=t(41020),he=t(85865),xe=t(66230);t(91343);const ue=e=>{const s=null===e||void 0===e?void 0:e.level_3;let t=0,i=0;if((null===s||void 0===s?void 0:s.length)>0){for(let e=0;e<(null===s||void 0===s?void 0:s.length);e++)t+=s[e].task_progress;i=t/s.length}else i=null===e||void 0===e?void 0:e.task_progress;return i},me=e=>{const s=null===e||void 0===e?void 0:e.level_2;let t=0,i=0;if((null===s||void 0===s?void 0:s.length)>0){for(let e=0;e<s.length;e++)t+=ue(s[e]);i=t/s.length}else i=null===e||void 0===e?void 0:e.task_progress;return i},je=()=>{const{auth:e}=(0,z.A)(),{projectId:s}=(0,y.g)(),[t,c]=(0,i.useState)(!1),[h,x]=(0,i.useState)(void 0),[u,m]=(0,i.useState)(),[j,p]=(0,i.useState)(),[b,N]=(0,i.useState)(!1),[S,C]=(0,i.useState)(),[D,T]=(0,i.useState)(),[L,M]=(0,i.useState)(0),P=(0,k.A)(),{search:Y}=(0,y.zy)(),{isLoading:V,error:q,data:J,refetch:H}=(0,f.I)({queryKey:["act"],queryFn:()=>P.get("api/task/".concat(s,"/activities/all").concat(Y)).then((e=>(C(e.data.project),e.data.data)))});(0,i.useEffect)((()=>{T(J),async function(){await P.post("api/project/progress/collection",{ids:[s]}).then((e=>{var s;M(null===(s=e.data.data[0])||void 0===s?void 0:s.progress)})).catch((e=>console.log(e)))}()}),[J]);const K=e=>{c(!0),x(e)},U=async s=>{m(s),p(!0),await P.post("api/task/".concat(null===e||void 0===e?void 0:e.user.employe_id,"/").concat(s,"/favorite")).then((e=>{H(),(0,I.x)("success",e.data.message)})).catch((()=>{(0,I.x)("error","Something went wrong.")})),m(),p(!1)},Z=["Director"],G=["Manager"];(0,i.useEffect)((()=>{null!==e&&void 0!==e&&e.user.roles.find((e=>Z.includes(e)))&&N(!0)}),[e]);const[X,Q]=i.useState(null),$=Boolean(X),ee=$?"simple-popover":void 0;return(0,i.useEffect)((()=>{H()}),[s]),(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(l.A,{children:(0,R.jsx)(n.A,{className:"rounded-3",children:(0,R.jsx)(a.A,{children:V?"loading...":q?"Something went wrong.":(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(d.A,{children:[(0,R.jsx)(l.A,{sm:"12 mb-2",md:"6",children:(0,R.jsxs)("div",{className:"d-flex gap-2",children:[(0,R.jsxs)(o.A,{type:"button",className:"d-flex align-items-center gap-2 rounded-3",color:"light",size:"sm",children:[(0,R.jsx)(A(),{icon:"filter_list",style:{fontSize:"12px"}}),"Sort"]}),(0,R.jsxs)(o.A,{type:"button",className:"d-flex align-items-center gap-2 rounded-3",color:"light",size:"sm",children:[(0,R.jsx)(A(),{icon:"tune",style:{fontSize:"12px"}}),"Filters"]})]})}),(0,R.jsx)(l.A,{sm:"12",md:"6",children:(0,R.jsxs)("div",{className:"d-flex gap-3 col-md-6 w-100",children:[(0,R.jsxs)("div",{className:"w-100 position-relative",children:[(0,R.jsx)(v.A,{type:"text",className:"rounded-3",bsSize:"md",placeholder:"Search task...",onChange:e=>(e=>{const s=J.filter((s=>s.task_title.toLowerCase().includes(e.toLowerCase())));T(s)})(e.target.value)}),(0,R.jsxs)("div",{className:"position-absolute top-0 end-0 h-100 p-1",children:[(0,R.jsx)(o.A,{type:"button",className:"btn btn-light w-100 h-100 border-0 rounded-3 text-muted","aria-describedby":ee,variant:"contained",onClick:e=>{Q(e.currentTarget)},children:(0,R.jsx)(A(),{icon:"more_horiz",style:{fontSize:"16px"}})}),(0,R.jsx)(oe.Ay,{id:ee,open:$,anchorEl:X,onClick:()=>{Q(null)},anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"center"},children:(0,R.jsx)(he.A,{sx:{p:2},children:(0,R.jsxs)(l.A,{children:[(0,R.jsx)(d.A,{children:(0,R.jsx)(_.N_,{to:"#",children:"Task"})}),(0,R.jsx)(d.A,{children:(0,R.jsx)(_.N_,{to:"#",children:"Employee"})}),(0,R.jsx)(d.A,{children:(0,R.jsx)(_.N_,{to:"#",children:"Date"})})]})})})]})]}),(null===e||void 0===e?void 0:e.user.roles.find((e=>G.includes(e))))&&(0,R.jsx)(re.XP,{document:(0,R.jsx)(xe.A,{projectTitle:S,data:J}),fileName:"Task Report - ".concat(null===S||void 0===S?void 0:S.project_number," - ").concat(null===S||void 0===S?void 0:S.division),style:{textDecoration:"none"},children:(0,R.jsx)(o.A,{type:"button",className:"btn btn-light-info text-info rounded-3 d-flex py-2",children:(0,R.jsx)(A(),{icon:"file_download",style:{fontSize:"18px"}})})})]})})]}),(0,R.jsxs)(l.A,{sm:"12 overflow-auto",children:[(0,R.jsxs)("div",{className:"d-flex align-items-center justify-content-between mt-2",children:[(0,R.jsxs)("h6",{className:"fw-bold",children:["List of tasks from ",null===S||void 0===S?void 0:S.division]}),(0,R.jsx)("div",{className:"w-25",children:(0,R.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[(0,R.jsx)("div",{style:{width:"86%"},children:(0,R.jsx)(r.A,{className:"",color:"success",value:L.toFixed(),style:{height:"12px"}})}),(0,R.jsxs)("span",{className:"fw-bold",children:[L.toFixed(),"%"]})]})})]}),(0,R.jsxs)("table",{className:"rounded-corners act-table",children:[(0,R.jsx)("thead",{children:(0,R.jsxs)("tr",{children:[(0,R.jsx)("th",{width:"30",children:"#"}),(0,R.jsx)("th",{colSpan:"3",style:{minWidth:"400px"},children:"Task title"}),(0,R.jsx)("th",{width:"",children:"Status"}),(0,R.jsx)("th",{style:{minWidth:"100px"},children:"Start date"}),(0,R.jsx)("th",{style:{minWidth:"100px"},children:"Due date"}),(0,R.jsx)("th",{children:"Progress"}),(0,R.jsx)("th",{width:"100",children:"PIC"}),b&&(0,R.jsx)("th",{width:"50"})]})}),(0,R.jsx)("tbody",{children:(null===D||void 0===D?void 0:D.length)>0?null===D||void 0===D?void 0:D.map(((e,s)=>{var t,l,n,a,d,c;return(0,R.jsxs)(i.Fragment,{children:[(0,R.jsxs)("tr",{children:[(0,R.jsxs)("td",{children:[s+1,"."]}),(0,R.jsxs)("td",{colSpan:"3",style:{cursor:"pointer"},onClick:()=>K(e),children:[(0,R.jsx)("span",{style:{fontWeight:"600"},children:e.task_title}),(0,R.jsx)("br",{}),(0,R.jsxs)(O.A,{color:"light",className:"text-muted",children:[null===e||void 0===e||null===(t=e.level_2)||void 0===t?void 0:t.length," subtask"]}),"  ",(0,R.jsxs)(O.A,{color:"light",className:"text-muted",children:[(0,R.jsx)(A(),{icon:"comment",style:{fontSize:"12px"}}),e.comments]})]}),(0,R.jsx)("td",{children:0===e.status?(0,R.jsx)(O.A,{color:"light",className:"text-dark",children:"To Do"}):1===e.status?(0,R.jsx)(O.A,{color:"warning",children:"In Progress"}):2===e.status?(0,R.jsx)(O.A,{color:"light",className:"text-dark",children:"Under Review"}):3===e.status?(0,R.jsx)(O.A,{color:"success",children:"Approved"}):(0,R.jsx)(O.A,{color:"danger",children:"Revision"})}),(0,R.jsx)("td",{children:(0,E.A)(e.start_date)}),(0,R.jsx)("td",{className:"".concat((0,W.A)(e.end_date)?"text-danger":""),children:(0,E.A)(e.end_date)}),(0,R.jsx)("td",{children:(0,R.jsxs)("span",{className:"badge bg-light-success text-primary rounded-pill d-inline-block fw-bold",children:[null===(l=me(e))||void 0===l?void 0:l.toFixed(),"%"]})}),(0,R.jsx)("td",{children:(0,R.jsx)("div",{className:"members",children:(0,R.jsxs)("div",{className:"members-item",children:[null===e||void 0===e||null===(n=e.pics)||void 0===n?void 0:n.map(((e,s)=>{var t;return s<2&&(0,R.jsxs)(i.Fragment,{children:[(0,R.jsx)("img",{id:"tooltip-".concat(e.id),src:w,className:"ava-pic rounded-circle",alt:"avatar",width:"35",height:"35"}),(0,R.jsx)(F.A,{title:e.first_name,id:null===(t=e.id)||void 0===t?void 0:t.toString()})]},e.id)})),(null===e||void 0===e||null===(a=e.pics)||void 0===a?void 0:a.length)>2&&(0,R.jsxs)("div",{className:"member-plus bg-light-info text-info fw-bold",children:["+",e.pics.length-2]})]})})}),b&&(0,R.jsx)("td",{className:"text-center",children:j&&u===e.task_id?(0,R.jsx)(g.A,{size:"sm",color:"warning"}):(0,R.jsx)("abbr",{title:"Mark task",style:{textDecoration:"none"},children:(0,R.jsx)("button",{type:"button",className:"fav-btn",onClick:()=>U(e.task_id),children:(0,R.jsx)(A(),{icon:"star",className:"".concat(e.isFavorite&&"is_favorite")})})})})]}),(null===(d=e.level_2)||void 0===d?void 0:d.length)>0&&(null===(c=e.level_2)||void 0===c?void 0:c.map(((e,t)=>{var l,n,a,d,c,r;return(0,R.jsxs)(i.Fragment,{children:[(0,R.jsxs)("tr",{children:[(0,R.jsx)("td",{}),(0,R.jsxs)("td",{width:"5",children:[s+1,".",t+1]}),(0,R.jsxs)("td",{colSpan:"2",onClick:()=>K(e),style:{cursor:"pointer",textAlign:"left",fontWeight:"500"},children:[e.task_title,(0,R.jsx)("br",{}),(0,R.jsxs)(O.A,{color:"light",className:"text-muted",children:[null===e||void 0===e||null===(l=e.level_3)||void 0===l?void 0:l.length," subtask"]}),"  ",(0,R.jsxs)(O.A,{color:"light",className:"text-muted",children:[(0,R.jsx)(A(),{icon:"comment",style:{fontSize:"12px"}}),e.comments]})]}),(0,R.jsx)("td",{children:"-"}),(0,R.jsx)("td",{children:(0,E.A)(e.start_date)}),(0,R.jsx)("td",{className:"".concat((0,W.A)(e.end_date)?"text-danger":""),children:(0,E.A)(e.end_date)}),(0,R.jsx)("td",{children:(0,R.jsxs)("span",{className:"badge bg-light-primary text-primary rounded-pill d-inline-block fw-bold",children:[null===(n=ue(e))||void 0===n?void 0:n.toFixed(),"%"]})}),(0,R.jsx)("td",{children:(0,R.jsx)("div",{className:"members",children:(0,R.jsxs)("div",{className:"members-item",children:[null===e||void 0===e||null===(a=e.pics)||void 0===a?void 0:a.map(((e,s)=>{var t;return s<2&&(0,R.jsxs)(i.Fragment,{children:[(0,R.jsx)("img",{id:"tooltip-".concat(e.id),src:w,className:"ava-pic rounded-circle",alt:"avatar",width:"35",height:"35"}),(0,R.jsx)(F.A,{title:e.first_name,id:null===(t=e.id)||void 0===t?void 0:t.toString()})]},e.id)})),(null===e||void 0===e||null===(d=e.pics)||void 0===d?void 0:d.length)>2&&(0,R.jsxs)("div",{className:"member-plus bg-light-info text-info fw-bold",children:["+",e.pics.length-2]})]})})}),b&&(0,R.jsx)("td",{className:"text-center",children:j&&u===e.task_id?(0,R.jsx)(g.A,{size:"sm",color:"warning"}):(0,R.jsx)("abbr",{title:"Mark task",style:{textDecoration:"none"},children:(0,R.jsx)("button",{type:"button",className:"fav-btn",onClick:()=>U(e.task_id),children:(0,R.jsx)(A(),{icon:"star",className:"".concat(e.isFavorite&&"is_favorite")})})})})]},e.task_id),(null===(c=e.level_3)||void 0===c?void 0:c.length)>0&&(null===(r=e.level_3)||void 0===r?void 0:r.map(((e,l)=>{var n,a,d;return(0,R.jsxs)("tr",{children:[(0,R.jsx)("td",{}),(0,R.jsx)("td",{}),(0,R.jsxs)("td",{width:"5",children:[s+1,".",t+1,".",l+1]}),(0,R.jsxs)("td",{onClick:()=>K(e),style:{cursor:"pointer",textAlign:"left"},children:[e.task_title,(0,R.jsx)("br",{}),(0,R.jsxs)(O.A,{color:"light",className:"text-muted",children:[(0,R.jsx)(A(),{icon:"comment",style:{fontSize:"12px"}}),e.comments]})]}),(0,R.jsx)("td",{children:"-"}),(0,R.jsx)("td",{children:(0,E.A)(e.start_date)}),(0,R.jsx)("td",{className:"".concat((0,W.A)(e.end_date)?"text-danger":""),children:(0,E.A)(e.end_date)}),(0,R.jsx)("td",{children:(0,R.jsxs)("span",{className:"badge bg-light-primary text-primary rounded-pill d-inline-block fw-bold",children:[null===e||void 0===e||null===(n=e.task_progress)||void 0===n?void 0:n.toFixed(),"%"]})}),(0,R.jsx)("td",{children:(0,R.jsx)("div",{className:"members",children:(0,R.jsxs)("div",{className:"members-item",children:[null===e||void 0===e||null===(a=e.pics)||void 0===a?void 0:a.map(((e,s)=>{var t;return s<2&&(0,R.jsxs)(i.Fragment,{children:[(0,R.jsx)("img",{id:"tooltip-".concat(e.id),src:w,className:"ava-pic rounded-circle",alt:"avatar",width:"35",height:"35"}),(0,R.jsx)(F.A,{title:e.first_name,id:null===(t=e.id)||void 0===t?void 0:t.toString()})]},e.id)})),(null===e||void 0===e||null===(d=e.pics)||void 0===d?void 0:d.length)>2&&(0,R.jsxs)("div",{className:"member-plus bg-light-info text-info fw-bold",children:["+",e.pics.length-2]})]})})}),b&&(0,R.jsx)("td",{className:"text-center",children:j&&u===e.task_id?(0,R.jsx)(g.A,{size:"sm",color:"warning"}):(0,R.jsx)("abbr",{title:"Mark task",style:{textDecoration:"none"},children:(0,R.jsx)("button",{type:"button",className:"fav-btn",onClick:()=>U(e.task_id),children:(0,R.jsx)(A(),{icon:"star",className:"".concat(e.isFavorite&&"is_favorite")})})})})]},e.task_id)})))]},e.task_id)})))]},e.task_id)})):(0,R.jsx)("tr",{children:(0,R.jsx)("td",{colSpan:"9",align:"center",children:"No data available"})})})]})]})]})})})}),t&&(0,R.jsx)(B.A,{modal:t,setModal:c,toggle:()=>{c(!t)},task:h,mode:"activities"})]})},ve=e=>{let{setTotalBastReview:s}=e;const{auth:t}=(0,z.A)(),{projectId:d}=(0,y.g)(),[r,j]=(0,i.useState)(!1),[b,N]=(0,i.useState)(""),[S,F]=(0,i.useState)(),[E,D]=(0,i.useState)(),[T,L]=(0,i.useState)(),[M,P]=(0,i.useState)(),[B,Y]=(0,i.useState)(!1),V=(0,k.A)(),{isLoading:q,error:W,data:J,refetch:H}=(0,f.I)({queryKey:["bast-review"],queryFn:()=>V.get("api/project/".concat(d,"/").concat(null===t||void 0===t?void 0:t.user.employe_id,"/bast/review")).then((e=>e.data.data))});(0,i.useEffect)((()=>{s(10)}),[J]);const K=(e,s,t,i)=>{j(!0),N(e),D(s||null),L(t),P(i)},U=()=>{j(!r)};return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(l.A,{children:q?(0,R.jsx)(n.A,{children:(0,R.jsx)(a.A,{children:"Loading..."})}):W?"Something went wrong.":(0,R.jsx)(n.A,{className:"custom-card",children:J&&(0,R.jsxs)(a.A,{children:[(0,R.jsxs)(c.A,{tag:"h4",className:"d-flex justify-content-between",children:[(0,R.jsx)("div",{className:"d-flex gap-2",children:(0,R.jsx)(O.A,{color:"light",className:"text-dark",children:"Review BAST"})}),(0,R.jsx)("span",{style:{fontSize:"14px"},children:(0,C.A)(J.created_at)})]}),(0,R.jsx)("div",{className:"d-flex  justify-content-center",children:(0,R.jsxs)("h5",{children:["Handover of the project from ",(0,R.jsx)("strong",{children:J.old_pic_division})," to"," ",(0,R.jsx)("strong",{children:J.new_pic_division})]})}),(0,R.jsx)("span",{className:"text-dark",children:"BAST file:"}),(0,R.jsx)("div",{className:"",children:(0,R.jsx)("div",{className:"d-flex gap-3",children:(0,R.jsx)(_.N_,{className:"file-link",to:"",target:"blank",children:J.file})})}),(0,R.jsxs)("div",{className:"d-flex justify-content-between align-items-center mt-4 border  py-2 px-3",style:{borderRadius:"10px"},children:[(0,R.jsx)("div",{className:"d-flex gap-4",children:(0,R.jsxs)("div",{className:"d-flex gap-3 align-items-center",children:[(0,R.jsx)("img",{src:w,className:"rounded-circle",alt:"avatar",width:"45",height:"45"}),(0,R.jsxs)("div",{className:"d-flex flex-column",children:[(0,R.jsx)("span",{className:"text-dark fw-bold",children:J.old_pic}),(0,R.jsx)("small",{className:"text-muted",children:J.old_pic_division})]})]})}),(0,R.jsxs)("div",{className:"d-flex gap-2",children:[(0,R.jsx)(o.A,{type:"button",size:"md",color:"warning",outline:!0,onClick:()=>K("revision",J.old_pic_id,J.review_by),children:"Revision"}),(0,R.jsx)(o.A,{type:"button",size:"md",color:"success",onClick:()=>K("approve",J.old_pic_id,J.new_pic_id,J.review_by),children:"Approve"})]})]})]})})}),(0,R.jsxs)(h.A,{isOpen:r,toggle:U.bind(null),size:"md",fade:!1,centered:!0,children:[(0,R.jsx)(x.A,{toggle:U.bind(null),children:"approve"===b?"Approval":"Revision"}),(0,R.jsxs)(ae.A,{onSubmit:async e=>{e.preventDefault(),Y(!0),await V.post("api/project/".concat(null===J||void 0===J?void 0:J.history_id,"/bast/approval"),{project_id:d,old_pic:E,notif_to:T,review_by:M,status:"approve"===b?"handover":"revision",note:S}).then((()=>{H(),(0,I.x)("success","BAST has been ".concat("approve"===b?"approved":"reviewed"))})).catch((e=>console.log(e))),j(!1),Y(!1)},children:[(0,R.jsx)(u.A,{children:(0,R.jsx)(m.A,{children:(0,R.jsx)(v.A,{type:"textarea",id:"goals",name:"goals",placeholder:"Comment here..",rows:"3",required:!0,onChange:e=>F(e.target.value)})})}),(0,R.jsxs)(p.A,{children:[(0,R.jsx)(o.A,{color:"secondary",outline:!0,onClick:U.bind(null),children:"Cancel"}),(0,R.jsx)(o.A,{type:"submit",color:"".concat("approve"===b?"success":"warning"),disabled:B,className:"d-flex gap-1 align-items-center",children:B?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(g.A,{className:"me-2",size:"sm"}),"Sending..."]}):(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(A(),{icon:"send",style:{fontSize:"20px"}}),"approve"===b?"Approve":"Send"]})})]})]})]})]})},pe=e=>{let{navActive:s,setTotalReview:t,setTotalBastReview:i,roles:l}=e;return(0,R.jsxs)(R.Fragment,{children:[1===s&&(0,R.jsx)(M,{}),!l.includes("Director")&&2===s&&(0,R.jsx)(se,{}),3===s&&(0,R.jsx)(ie,{}),4===s&&(0,R.jsx)(ne,{}),5===s&&(0,R.jsx)(de,{setTotalReview:t}),!l.includes("Director")&&6===s&&(0,R.jsx)(ce,{}),7===s&&(0,R.jsx)(je,{}),8===s&&(0,R.jsx)(ve,{setTotalBastReview:i})]})};t(46592);var ge=t(81509),fe=t(98288),be=t(11387);const Ae=e=>{var s,t,n,a,c,r;let{modal:f,setModal:b,toggle:A,data:y,refetch:_}=e;const[w,C]=(0,i.useState)({}),[z,F]=(0,i.useState)({}),[E,D]=(0,i.useState)({}),[T,L]=(0,i.useState)([]),[M,O]=(0,i.useState)({}),[B,Y]=(0,i.useState)(!1),[V,q]=(0,i.useState)(!1),[W,J]=(0,i.useState)(!1),[H,K]=(0,i.useState)(),[U,Z]=(0,i.useState)({}),[G,X]=(0,i.useState)({}),[Q,$]=(0,i.useState)(),[ee,se]=(0,i.useState)(!1),te=(0,S.Ay)(),ie=(0,k.A)();(0,i.useEffect)((()=>{var e,s,t,i,l,n;C(y),F({project_number:null===y||void 0===y?void 0:y.project_number,project_name:null===y||void 0===y?void 0:y.project_name,goals:null===y||void 0===y?void 0:y.goals,estimated_income:null===y||void 0===y?void 0:y.estimated_income,estimated_cost:null===y||void 0===y?void 0:y.estimated_cost,base_id:null===y||void 0===y?void 0:y.base_id,level_id:null===y||void 0===y?void 0:y.level_id,business_id:null===y||void 0===y?void 0:y.business_id,category:null===y||void 0===y?void 0:y.category,start_date:null===y||void 0===y||null===(e=y.current_stage)||void 0===e?void 0:e.start_date,end_date:null===y||void 0===y||null===(s=y.current_stage)||void 0===s?void 0:s.end_date,desc:null===y||void 0===y||null===(t=y.current_stage)||void 0===t?void 0:t.desc,partner:null===y||void 0===y||null===(i=y.current_stage)||void 0===i?void 0:i.partner_id}),$({value:null===y||void 0===y?void 0:y.business_id,label:null===y||void 0===y?void 0:y.business_desc}),X({value:null===y||void 0===y||null===(l=y.current_stage)||void 0===l?void 0:l.partner_name,label:null===y||void 0===y||null===(n=y.current_stage)||void 0===n?void 0:n.partner_name})}),[y]);const le=async()=>{await ie.get("api/project/business/options").then((e=>D(e.data))).catch((e=>console.log(e)))};(0,i.useEffect)((()=>{le(),async function(){await ie.get("api/list-mitra").then((e=>L(e.data.data))).catch((e=>console.log(e)))}()}),[]),(0,i.useEffect)((()=>{T.unshift({label:"TAMBAH LAINNYA",value:"LAINNYA"})}),[T]),(0,i.useEffect)((()=>{"LAINNYA"===(null===M||void 0===M?void 0:M.value)&&(se(!0),O({}))}),[M]);const ne=e=>{F((s=>(0,P.A)((0,P.A)({},s),{},{[e.target.name]:e.target.value})))};(0,i.useEffect)((()=>{"another"===(null===z||void 0===z?void 0:z.base_id)&&q(!0)}),[z]);return(0,R.jsx)(R.Fragment,{children:(0,R.jsxs)(h.A,{isOpen:f,toggle:A.bind(null),size:"lg",fade:!1,children:[(0,R.jsx)(x.A,{toggle:A.bind(null),children:"Update Project"}),(0,R.jsxs)(ae.A,{onSubmit:async e=>{var s,t,i,l;e.preventDefault(),Y(!0),z.stage_id=null===w||void 0===w||null===(s=w.current_stage)||void 0===s?void 0:s.stage_id,z.partner=0!==(null===(t=Object.keys(M))||void 0===t?void 0:t.length)?M.value:null!==z&&void 0!==z&&z.partner?null===z||void 0===z?void 0:z.partner:null===y||void 0===y||null===(i=y.current_stage)||void 0===i?void 0:i.partner_name,z.business_id=0!==(null===(l=Object.keys(U))||void 0===l?void 0:l.length)?U.value:null===y||void 0===y?void 0:y.business_id,await ie.patch("api/project/".concat(null===w||void 0===w?void 0:w.project_id,"/update"),z).then((()=>{_(),(0,I.x)("success","Project has been updated.")})).catch((()=>{(0,I.x)("error","Something went wrong.")})),se(!1),Y(!1),b(!1)},children:[(0,R.jsxs)(u.A,{children:[(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{htmlFor:"project_number",children:"Project Number"}),(0,R.jsx)(v.A,{type:"text",name:"project_number",id:"project_number",placeholder:"Project number here",onChange:ne,defaultValue:(null===w||void 0===w?void 0:w.project_number)||""})]}),(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{htmlFor:"project_name",children:"Project name"}),(0,R.jsx)(v.A,{type:"text",name:"project_name",id:"project_name",placeholder:"Project name here",onChange:ne,defaultValue:null===w||void 0===w?void 0:w.project_name})]}),(0,R.jsxs)(d.A,{children:[(0,R.jsx)(l.A,{md:"6",children:(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{for:"start_date",children:"Start date"}),(0,R.jsx)(v.A,{type:"date",id:"start_date",name:"start_date",onChange:ne,defaultValue:(null===w||void 0===w||null===(s=w.current_stage)||void 0===s?void 0:s.start_date)||""})]})}),(0,R.jsx)(l.A,{md:"6",children:(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{for:"end_date",children:"End date"}),(0,R.jsx)(v.A,{type:"date",id:"end_date",name:"end_date",onChange:ne,defaultValue:(null===w||void 0===w||null===(t=w.current_stage)||void 0===t?void 0:t.end_date)||""})]})})]}),(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{htmlFor:"goals",children:"Goals"}),(0,R.jsx)(v.A,{type:"textarea",id:"goals",name:"goals",placeholder:"Explain the goals of the project here",rows:"3",onChange:ne,defaultValue:(null===w||void 0===w?void 0:w.goals)||""})]}),(0,R.jsxs)(d.A,{children:[(0,R.jsx)(l.A,{md:"6",children:(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{for:"level_id",children:"Activity level"}),(0,R.jsxs)(v.A,{type:"select",id:"level_id",name:"level_id",onChange:ne,defaultValue:(null===w||void 0===w?void 0:w.level_id)||"",children:[(0,R.jsx)("option",{disabled:!0,value:"al",children:"- Select -"}),null===E||void 0===E||null===(n=E.activity_level)||void 0===n?void 0:n.map((e=>(0,R.jsx)("option",{value:e.level_id,children:e.level_desc},e.level_id)))]})]})}),(0,R.jsx)(l.A,{md:"6",children:(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{for:"category",children:"Category"}),(0,R.jsxs)(v.A,{type:"select",id:"category",name:"category",onChange:ne,defaultValue:(null===w||void 0===w?void 0:w.category)||"",children:[(0,R.jsx)("option",{disabled:!0,value:"cat",children:"- Select -"}),(0,R.jsx)("option",{value:"business",children:"Business"}),(0,R.jsx)("option",{value:"non-business",children:"Non-business"})]})]})})]}),("business"===(null===w||void 0===w?void 0:w.category)||"business"===(null===z||void 0===z?void 0:z.category))&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{for:"partner",children:"Partner"}),ee?(0,R.jsx)(v.A,{type:"text",name:"partner",id:"partner",placeholder:"Type here..",onChange:ne}):(0,R.jsx)(N.Ay,{components:te,options:T,defaultValue:G,onChange:e=>O(e)})]}),(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{htmlFor:"desc",children:"Description for Initiation & Definition phase"}),(0,R.jsx)(v.A,{type:"textarea",id:"desc",name:"desc",placeholder:"Description of the phase here",rows:"3",onChange:ne,defaultValue:null===w||void 0===w||null===(a=w.current_stage)||void 0===a?void 0:a.desc})]}),(0,R.jsxs)(d.A,{children:[(0,R.jsx)(l.A,{md:"6",children:(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{htmlFor:"estimated_income",children:"Estimated income"}),(0,R.jsxs)(fe.A,{children:[(0,R.jsx)(be.A,{children:"Rp."}),(0,R.jsx)(v.A,{type:"number",min:"1",id:"estimated_income",name:"estimated_income",onChange:ne,defaultValue:(null===w||void 0===w?void 0:w.estimated_income)||""})]})]})}),(0,R.jsx)(l.A,{md:"6",children:(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{htmlFor:"estimated_cost",children:"Estimated cost"}),(0,R.jsxs)(fe.A,{children:[(0,R.jsx)(be.A,{children:"Rp."}),(0,R.jsx)(v.A,{type:"number",min:"1",id:"estimated_cost",name:"estimated_cost",onChange:ne,defaultValue:(null===w||void 0===w?void 0:w.estimated_cost)||""})]})]})})]})]}),V?(0,R.jsx)(d.A,{children:(0,R.jsx)(l.A,{md:"12",children:(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{for:"activity_name",children:"Add Activity Base"}),(0,R.jsxs)("div",{className:"d-flex gap-3",children:[(0,R.jsx)("div",{style:{width:"70%"},children:(0,R.jsx)(v.A,{type:"text",name:"activity_name",id:"activity_name",placeholder:"Type here..",onChange:e=>K(e.target.value)})}),(0,R.jsx)(o.A,{className:"d-flex align-items-center",type:"button",color:"success",size:"sm",onClick:async()=>{J(!0),H?await ie.post("api/project/activity-base/add",{activity_name:H}).then((e=>{le(),(0,I.x)("success",e.data.message)})).catch((()=>{(0,I.x)("error","Something went wrong")})):(0,I.x)("error","Field cannot be empty"),K(),q(!1),J(!1)},disabled:W,children:W?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(g.A,{className:"me-2",size:"sm",color:"light"}),"Loading"]}):"Save"}),(0,R.jsx)(o.A,{type:"button",outline:!0,onClick:()=>q(!1),disabled:W,children:"Cancel"})]})]})})}):(0,R.jsxs)(d.A,{children:[(0,R.jsx)(l.A,{md:"6",children:(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{for:"base_id",children:"Activity base"}),(0,R.jsxs)(v.A,{type:"select",id:"base_id",name:"base_id",defaultValue:(null===w||void 0===w?void 0:w.base_id)||"",onChange:ne,style:{textOverflow:"ellipsis"},children:[(0,R.jsx)("option",{disabled:!0,value:"ab",children:"- Select -"}),null===E||void 0===E||null===(c=E.activity_base)||void 0===c?void 0:c.map((e=>(0,R.jsx)("option",{value:e.base_id,style:{width:"4rem",textOverflow:"ellipsis"},children:e.base_description},e.base_id))),(0,R.jsx)("option",{value:"another",children:"Tambah Lainnya"})]})]})}),(0,R.jsx)(l.A,{md:"6",children:(0,R.jsxs)(m.A,{children:[(0,R.jsx)(j.A,{for:"business_id",className:"text-muted",children:"Business plan"}),"3"===(null===z||void 0===z?void 0:z.base_id)||"3"===(null===w||void 0===w||null===(r=w.base_id)||void 0===r?void 0:r.toString())?(0,R.jsx)(N.Ay,{components:te,options:null===E||void 0===E?void 0:E.business_plan,defaultValue:Q,onChange:e=>Z(e)}):(0,R.jsx)(v.A,{type:"select",disabled:!0,defaultValue:""})]})})]})]}),(0,R.jsxs)(p.A,{children:[(0,R.jsx)(o.A,{type:"submit",color:"info",disabled:B,children:B?(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(g.A,{className:"me-2",size:"sm",color:"light"}),"Loading ..."]}):"Update"}),(0,R.jsx)(o.A,{color:"secondary",outline:!0,onClick:A.bind(null),children:"Cancel"})]})]})]})})},ye=["Manager","Director"],_e=["Director"],Ne=e=>{var s,t,c,r,m,j,v,g,b,N,S,C;let{navActive:F,setNavActive:E,totalReview:D,totalBastReview:T}=e;const[L,M]=(0,i.useState)(""),[P,O]=(0,i.useState)(0),{auth:B}=(0,z.A)(),{roles:Y}=B.user,V=(0,k.A)(),{projectId:q}=(0,y.g)(),[W,J]=(0,i.useState)(!1),[H,K]=(0,i.useState)(),[U,Z]=(0,i.useState)(!1),[G,X]=(0,i.useState)(!1),[Q,$]=(0,i.useState)(!1),ee=(0,y.Zp)(),se=()=>{X(!G)},te=new URLSearchParams(window.location.search),ie=te.get("to");(0,i.useEffect)((()=>{"review"===ie?E(5):"handover"===ie?E(6):"overview"===ie?E(1):"activities"===ie?E(7):"bast-review"===ie&&E(8)}),[te]),(0,i.useEffect)((()=>{null!==Y&&void 0!==Y&&Y.find((e=>ye.includes(e)))&&async function(){await V.get("api/task/".concat(q,"/level1/review")).then((e=>M(e.data.data))).catch((e=>console.log(e)))}()}),[D]),(0,i.useEffect)((()=>{null!==Y&&void 0!==Y&&Y.find((e=>_e.includes(e)))&&async function(){await V.get("api/project/".concat(q,"/").concat(null===B||void 0===B?void 0:B.user.employe_id,"/bast/review")).then((e=>{O(e.data.data)})).catch((e=>console.log(e)))}()}),[T]);const{isLoading:le,data:ne,refetch:ae}=(0,f.I)({queryKey:["project-number"],queryFn:()=>V.get("api/project/".concat(q)).then((e=>e.data.data))});(0,i.useEffect)((()=>{ae()}),[q]),(0,i.useEffect)((()=>{"business"===(null===ne||void 0===ne?void 0:ne.category)?K(!0):K(!1)}),[ne]);const de=["Staff","Manager"],ce=["Staff","Manager","Director"],re=["Manager","Director"],oe=["Staff","Manager"],he=["Director"],xe=["Manager","Director"],ue=["Manager"];return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(l.A,{className:"nav-container mb-3",children:[(0,R.jsxs)(d.A,{sm:"12",lg:"8",className:"project-nav overflow-auto",children:[(0,R.jsx)(_.N_,{className:"".concat(1===F&&"active"," text-muted fw-bold"),onClick:()=>E(1),children:"Overview"}),(null===B||void 0===B||null===(s=B.user)||void 0===s?void 0:s.roles.find((e=>de.includes(e))))&&(0,R.jsx)(_.N_,{className:"".concat(2===F&&"active"," text-muted fw-bold"),onClick:()=>E(2),children:"Board"}),(null===B||void 0===B||null===(t=B.user)||void 0===t?void 0:t.roles.find((e=>re.includes(e))))&&(0,R.jsx)(_.N_,{className:"".concat(7===F&&"active"," text-muted fw-bold"),onClick:()=>E(7),children:"Activities"}),(null===B||void 0===B||null===(c=B.user)||void 0===c?void 0:c.roles.find((e=>oe.includes(e))))&&(0,R.jsx)(R.Fragment,{children:(0,R.jsx)(_.N_,{className:"".concat(4===F&&"active"," text-muted fw-bold"),onClick:()=>E(4),children:"Files"})}),(null===B||void 0===B||null===(r=B.user)||void 0===r?void 0:r.roles.find((e=>he.includes(e))))&&!(null!==B&&void 0!==B&&null!==(m=B.user)&&void 0!==m&&m.roles.includes("Presdir"))&&(0,R.jsxs)(_.N_,{className:"".concat(8===F&&"active"," text-muted fw-bold"),onClick:()=>E(8),children:["BAST Review"," ",(0,R.jsx)("div",{color:"danger",className:"count ".concat(P?"bg-danger text-white":"bg-light text-dark"),children:null===P||void 0===P?void 0:P.length})]}),(null===B||void 0===B||null===(j=B.user)||void 0===j?void 0:j.roles.find((e=>xe.includes(e))))&&(0,R.jsx)(R.Fragment,{children:(0,R.jsxs)(_.N_,{className:"".concat(5===F&&"active"," text-muted fw-bold"),onClick:()=>E(5),children:["Review"," ",(0,R.jsx)("div",{color:"danger",className:"count ".concat((null===L||void 0===L?void 0:L.length)>0?"bg-danger text-white":"bg-light text-dark"),children:null===L||void 0===L?void 0:L.length})]})}),(null===B||void 0===B||null===(v=B.user)||void 0===v?void 0:v.roles.find((e=>ue.includes(e))))&&(0,R.jsxs)(_.N_,{className:"".concat(6===F&&"active"," text-muted fw-bold"),onClick:()=>E(6),children:["Handover"," "]}),(null===B||void 0===B||null===(g=B.user)||void 0===g?void 0:g.roles.find((e=>ce.includes(e))))&&(0,R.jsx)(_.N_,{className:"".concat(3===F&&"active"," text-muted fw-bold"),onClick:()=>E(3),children:"Members"})]}),(0,R.jsx)(d.A,{sm:"12",style:{fontSize:"20px",marginRight:"10px",textAlign:"right",minWidth:"35%"},children:(0,R.jsx)("span",{className:"fw-bold",children:le?"Loading..":null===ne||void 0===ne?void 0:ne.project_number})})]}),(0,R.jsx)(n.A,{className:"rounded-3 mb-3",children:(0,R.jsx)(a.A,{children:le?(0,R.jsx)("p",{children:"Loading..."}):(0,R.jsxs)(d.A,{children:[(0,R.jsxs)(l.A,{lg:"8",children:[(0,R.jsx)(d.A,{md:"12",children:(0,R.jsx)("h5",{className:"fw-bold",children:null===ne||void 0===ne?void 0:ne.project_name})}),H?(0,R.jsxs)(d.A,{lg:"12",children:[(0,R.jsx)(l.A,{sm:"12 mb-2",md:"4",children:(0,R.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,R.jsx)(A(),{icon:"manage_accounts",className:"text-muted",style:{fontSize:"28px"}}),(0,R.jsxs)("div",{className:"d-flex flex-column",children:[(0,R.jsx)("span",{className:"text-muted",style:{fontSize:"10px",marginBottom:"-4px"},children:"Partner"}),(0,R.jsx)("small",{className:"fw-bold",children:(null===ne||void 0===ne||null===(b=ne.current_stage)||void 0===b?void 0:b.partner_name)||"-"})]})]})}),(0,R.jsx)(l.A,{sm:"12 mb-2",md:"4",children:(0,R.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,R.jsx)(A(),{icon:"handshake",className:"text-muted",style:{fontSize:"28px"}}),(0,R.jsxs)("div",{className:"d-flex flex-column",children:[(0,R.jsx)("span",{className:"text-muted",style:{fontSize:"10px",marginBottom:"-4px"},children:"Schema"}),(0,R.jsx)("small",{className:"fw-bold",children:"jo"===(null===ne||void 0===ne||null===(N=ne.current_stage)||void 0===N?void 0:N.schema)?"Join Operational":"jv"===(null===ne||void 0===ne||null===(S=ne.current_stage)||void 0===S?void 0:S.schema)?"Join Venture":"-"})]})]})}),(0,R.jsx)(l.A,{sm:"12 mb-2",md:"4",children:(0,R.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,R.jsx)(A(),{icon:"play_circle_outline",className:"text-muted",style:{fontSize:"28px"}}),(0,R.jsxs)("div",{className:"d-flex flex-column",children:[(0,R.jsx)("span",{className:"text-muted",style:{fontSize:"10px",marginBottom:"-4px"},children:"Phase"}),(0,R.jsx)("small",{className:"fw-bold",children:null===ne||void 0===ne||null===(C=ne.current_stage)||void 0===C?void 0:C.phase})]})]})})]}):(0,R.jsx)(d.A,{lg:"12",children:(0,R.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,R.jsx)(A(),{icon:"work_off",style:{fontSize:"18px"}}),(0,R.jsx)("small",{className:"fw-bold",children:"Non-business"})]})})]}),(0,R.jsxs)(l.A,{lg:"4",className:"d-flex align-items-center justify-content-end",children:[(0,R.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,R.jsxs)("div",{className:"d-flex flex-column align-items-end",style:{marginLeft:"10px"},children:[(0,R.jsx)("small",{className:"fw-bold",children:null===ne||void 0===ne?void 0:ne.pic_active.first_name}),(0,R.jsx)("span",{className:"fw-bold",style:{fontSize:"14px"},children:null===ne||void 0===ne?void 0:ne.pic_active.organization_name})]}),(0,R.jsx)("img",{src:w,className:"rounded-circle",alt:"avatar",width:"35",height:"35"}),(null===B||void 0===B?void 0:B.user.first_name)===(null===ne||void 0===ne?void 0:ne.created_by)?(0,R.jsxs)("div",{className:"action-table",children:[(0,R.jsx)("button",{type:"button",className:"btn d-flex",onClick:()=>J(!0),children:(0,R.jsx)(A(),{icon:"more_vert"})}),W&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("div",{className:"action-overlay",onClick:()=>J(!1)}),(0,R.jsxs)("div",{className:"action-options",children:[(0,R.jsxs)(_.N_,{type:"button",className:"text-muted",onClick:()=>{Z(!0),J(void 0)},children:[(0,R.jsx)(A(),{icon:"update"}),"Update"]}),(0,R.jsxs)("button",{type:"button",className:"text-muted fw-bold",onClick:()=>{X(!G),J(!1)},children:[(0,R.jsx)(A(),{icon:"delete"}),"Delete"]})]})]})]}):""]}),(0,R.jsx)(Ae,{modal:U,setModal:Z,toggle:()=>{Z(!U)},data:ne,refetch:ae}),(0,R.jsxs)(h.A,{isOpen:G,toggle:se.bind(null),centered:!0,children:[(0,R.jsx)(x.A,{toggle:se.bind(null),children:"Confirmation"}),(0,R.jsx)(u.A,{children:(0,R.jsxs)("div",{className:"d-flex flex-column align-items-center",children:[(0,R.jsx)("h4",{children:null===ne||void 0===ne?void 0:ne.project_name}),"Are you sure you want to delete this project?"]})}),(0,R.jsxs)(p.A,{children:[(0,R.jsx)(o.A,{color:"danger",size:"sm",onClick:async()=>{$(!0),await V.delete("api/project/".concat(q)).then((()=>{(0,I.x)("success","Project has been deleted."),ee("/projects")})).catch((()=>{(0,I.x)("error","Something went wrong.")})),X(!G),$(!1)},disabled:Q,children:Q?"Deleting..":"Yes"}),(0,R.jsx)(o.A,{color:"secondary",size:"sm",outline:!0,onClick:se.bind(null),children:"Cancel"})]})]})]})]})})}),(0,R.jsx)(l.A,{lg:"12",children:(0,R.jsx)(ge.A,{color:"primary",className:"rounded-3",style:{fontSize:"14px"},children:(0,R.jsxs)("div",{className:"d-flex justify-content-between",children:[(0,R.jsxs)("div",{children:[(0,R.jsx)("span",{children:"Ketentuan task terbaru, "}),(0,R.jsx)(_.N_,{to:"https://drive.google.com/file/d/1So2xTY9FZA8GgWkvIO7zzo8LltyloljZ/view?usp=sharing",target:"blank",style:{textDecoration:"none"},children:"Baca selengkapnya"})]}),(0,R.jsx)(A(),{icon:"info"})]})})})]})},Se={task:["satu","dua"]},we=(0,i.createContext)(Se),ke=(e,s)=>"SET_TASK"===s.type?{task:s.payload}:e,Ce=e=>{let{children:s}=e;const[t,l]=(0,i.useReducer)(ke,Se);return(0,R.jsx)(we.Provider,{value:{task:t.task,dispatch:l},children:s})},ze=()=>{const{auth:e}=(0,z.A)(),{roles:s}=null===e||void 0===e?void 0:e.user,[t,l]=(0,i.useState)(2),[n,a]=(0,i.useState)(0),[d,c]=(0,i.useState)(0);return(0,i.useEffect)((()=>{s.includes("Director")&&l(1)}),[s]),(0,R.jsx)(Ce,{children:(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(Ne,{navActive:t,setNavActive:l,totalReview:n,totalBastReview:d}),(0,R.jsx)(pe,{navActive:t,setTotalReview:a,setTotalBastReview:c,roles:s})]})})}},49026:(e,s,t)=>{"use strict";t.d(s,{A:()=>i});const i=e=>{const s=new Date(e);return"".concat(s.getDate()," ").concat(["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Aug","Sep","Oct","Nov","Des"][s.getMonth()]," ").concat(s.getFullYear())}},24063:(e,s,t)=>{"use strict";t.d(s,{A:()=>i});const i=e=>{const s=new Date;return((new Date(e)-s)/864e5).toFixed()<1}},80519:(e,s,t)=>{"use strict";t.d(s,{A:()=>i});const i=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR"}).format(e)},46592:()=>{},91343:()=>{},50477:()=>{}}]);
//# sourceMappingURL=637.c4fefad4.chunk.js.map